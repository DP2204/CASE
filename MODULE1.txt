from flask import Flask, render_template, request, session, jsonify
import json
import os

app = Flask(__name__)
app.secret_key = "your_secret_key"

# ===== SSO Simulation =====
@app.before_request
def set_sso_user():
    # Simulate getting SSO headers
    uid = request.headers.get("Bnppglobalid", "guest")
    first_name = request.headers.get("Bnppfirstname", "")
    last_name = request.headers.get("Bnpplastname", "")
    username = f"{first_name} {last_name}".strip() or "Guest User"

    session["uid"] = uid
    session["username"] = username

# ===== Home page =====
@app.route("/")
def base():
    return render_template("base.html")

# ===== Get last handover =====
@app.route("/handover/get")
def get_handover():
    if os.path.exists("handover.json"):
        with open("handover.json") as f:
            data = json.load(f)
    else:
        # Default handover
        data = {
            "ritms": "RITM0012345 Pending QA signoff",
            "incidents": "INC0098765 Jenkins monitoring",
            "changes": "CHG005544 - Artifactory upgrade at 2 AM",
            "comments": "Check PR queue and Sonar DB memory",
            "submittedBy": "System",
            "submittedAt": "Initial load",
            "acknowledgedBy": "",
            "acknowledgedAt": ""
        }
    return jsonify(data)

# ===== Save handover =====
@app.route("/handover/save", methods=["POST"])
def save_handover():
    data = request.json
    with open("handover.json", "w") as f:
        json.dump(data, f)
    return jsonify({"status": "success"})


if __name__ == "__main__":
    app.run(debug=True)










<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System-wide Handover</title>
<style>
  .hidden { display: none; }
  .text-green { color: green; }
  .text-yellow { color: orange; }
</style>
</head>
<body>

<h2>System-wide Handover</h2>

<div>
  <label>RITMs: <input id="handover-ritms" /></label><br>
  <label>Incidents: <input id="handover-incidents" /></label><br>
  <label>Changes: <input id="handover-changes" /></label><br>
  <label>Comments: <input id="handover-comments" /></label><br>
  <button onclick="submitHandover()">Submit</button>
  <button id="ackBtn" onclick="acknowledgeHandover()">Acknowledge</button>
</div>

<h3>Summary:</h3>
<div id="handoverSummary"></div>

<!-- Pass Flask session username to JS -->
<script>
  window.SSO_USER = {{ session.get('username', 'Guest User') | tojson }};
</script>

<script>
async function loadHandover() {
    try {
        const res = await fetch("/handover/get");
        const data = await res.json();

        document.getElementById("handover-ritms").value = data.ritms;
        document.getElementById("handover-incidents").value = data.incidents;
        document.getElementById("handover-changes").value = data.changes;
        document.getElementById("handover-comments").value = data.comments;

        renderHandover(data);
    } catch (err) {
        console.error("Failed to load handover", err);
    }
}

function renderHandover(data) {
    const summaryEl = document.getElementById("handoverSummary");
    summaryEl.innerHTML = `
        <div>Submitted by <b>${data.submittedBy}</b> on ${data.submittedAt}</div>
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
        <div class="${data.acknowledgedBy ? 'text-green' : 'text-yellow'}">
            ${data.acknowledgedBy 
                ? `‚úî Acknowledged by <b>${data.acknowledgedBy}</b> (${data.acknowledgedAt})` 
                : 'Awaiting acknowledgment'}
        </div>
    `;

    const ackBtn = document.getElementById("ackBtn");
    if (ackBtn) ackBtn.classList.toggle("hidden", !!data.acknowledgedBy);
}

async function submitHandover() {
    const data = {
        ritms: document.getElementById("handover-ritms").value,
        incidents: document.getElementById("handover-incidents").value,
        changes: document.getElementById("handover-changes").value,
        comments: document.getElementById("handover-comments").value,
        submittedBy: window.SSO_USER,
        submittedAt: new Date().toLocaleString(),
        acknowledgedBy: document.getElementById("ackBtn").classList.contains("hidden") 
                        ? JSON.parse(localStorage.getItem("handoverData") || "{}").acknowledgedBy || "" 
                        : "",
        acknowledgedAt: document.getElementById("ackBtn").classList.contains("hidden") 
                        ? JSON.parse(localStorage.getItem("handoverData") || "{}").acknowledgedAt || "" 
                        : ""
    };

    await fetch("/handover/save", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });

    renderHandover(data);
}

async function acknowledgeHandover() {
    const res = await fetch("/handover/get");
    const data = await res.json();

    data.acknowledgedBy = window.SSO_USER;
    data.acknowledgedAt = new Date().toLocaleString();

    await fetch("/handover/save", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });

    renderHandover(data);
}

// Load last handover on page load
window.addEventListener("load", loadHandover);
</script>

</body>
</html>








<script>
/* =========================================================
   SSO USER (temporary)
========================================================= */
window.SSO_USER = window.SSO_USER || "Guest User";

/* =========================================================
   DEFAULT HANDOVER (ALWAYS VALID)
========================================================= */
const DEFAULT_HANDOVER = {
  ritms: "RITM0012345 - Pending QA signoff",
  incidents: "INC0098765 - Jenkins monitoring",
  changes: "CHG005544 - Artifactory upgrade",
  comments: "Check PR queue and Sonar DB memory",
  submittedBy: "System",
  submittedAt: "Initial load",
  acknowledgedBy: "",
  acknowledgedAt: ""
};

/* =========================================================
   SAFE LOAD
========================================================= */
function loadHandover() {
  let data;
  try {
    data = JSON.parse(localStorage.getItem("handoverData"));
  } catch (e) {
    data = null;
  }

  if (!data || !data.ritms) {
    data = DEFAULT_HANDOVER;
    localStorage.setItem("handoverData", JSON.stringify(data));
  }

  // Fill form safely
  const ritmsEl = document.getElementById("handover-ritms");
  const incidentsEl = document.getElementById("handover-incidents");
  const changesEl = document.getElementById("handover-changes");
  const commentsEl = document.getElementById("handover-comments");

  if (ritmsEl) ritmsEl.value = data.ritms;
  if (incidentsEl) incidentsEl.value = data.incidents;
  if (changesEl) changesEl.value = data.changes;
  if (commentsEl) commentsEl.value = data.comments;

  renderHandover(data);
}

/* =========================================================
   RENDER SUMMARY
========================================================= */
function renderHandover(data) {
  const summaryEl = document.getElementById("handoverSummary");
  if (!summaryEl) return;

  summaryEl.innerHTML = `
    <div class="text-xs text-gray-500 mb-1">
      Submitted by <b>${data.submittedBy}</b> on ${data.submittedAt}
    </div>
    <div><b>RITMs:</b> ${data.ritms}</div>
    <div><b>Incidents:</b> ${data.incidents}</div>
    <div><b>Changes:</b> ${data.changes}</div>
    <div><b>Notes:</b> ${data.comments}</div>
    ${
      data.acknowledgedBy
        ? `<div class="text-green-700 mt-2">
             ‚úî Acknowledged by <b>${data.acknowledgedBy}</b>
             (${data.acknowledgedAt})
           </div>`
        : `<div class="text-yellow-700 mt-2">
             Awaiting acknowledgment
           </div>`
    }
  `;

  const ackBtn = document.getElementById("ackBtn");
  if (ackBtn) ackBtn.classList.toggle("hidden", !!data.acknowledgedBy);
}

/* =========================================================
   SUBMIT
========================================================= */
function submitHandover() {
  const data = {
    ritms: document.getElementById("handover-ritms")?.value || "",
    incidents: document.getElementById("handover-incidents")?.value || "",
    changes: document.getElementById("handover-changes")?.value || "",
    comments: document.getElementById("handover-comments")?.value || "",
    submittedBy: window.SSO_USER,
    submittedAt: new Date().toLocaleString(),
    acknowledgedBy: "",
    acknowledgedAt: ""
  };

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* =========================================================
   ACKNOWLEDGE
========================================================= */
function acknowledgeHandover() {
  const data = JSON.parse(localStorage.getItem("handoverData") || "{}");
  if (!data) return;

  data.acknowledgedBy = window.SSO_USER;
  data.acknowledgedAt = new Date().toLocaleString();

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* =========================================================
   INIT
========================================================= */
window.addEventListener("load", loadHandover);
</script>






<script>
/* =========================================================
   SSO USER (temporary)
========================================================= */
window.SSO_USER = window.SSO_USER || "Guest User";

/* =========================================================
   DEFAULT HANDOVER (ALWAYS VALID)
========================================================= */
const DEFAULT_HANDOVER = {
  ritms: "RITM0012345 - Pending QA signoff",
  incidents: "INC0098765 - Jenkins monitoring",
  changes: "CHG005544 - Artifactory upgrade",
  comments: "Check PR queue and Sonar DB memory",
  submittedBy: "System",
  submittedAt: "Initial load",
  acknowledgedBy: "",
  acknowledgedAt: ""
};

/* =========================================================
   SAFE LOAD
========================================================= */
function loadHandover() {
  let data;

  try {
    data = JSON.parse(localStorage.getItem("handoverData"));
  } catch (e) {
    data = null;
  }

  // üîê SAFETY: If data missing or invalid ‚Üí fallback
  if (!data || !data.ritms) {
    data = DEFAULT_HANDOVER;
    localStorage.setItem("handoverData", JSON.stringify(data));
  }

  // Fill form
  document.getElementById("handover-ritms").value = data.ritms;
  document.getElementById("handover-incidents").value = data.incidents;
  document.getElementById("handover-changes").value = data.changes;
  document.getElementById("handover-comments").value = data.comments;

  renderHandover(data);
}

/* =========================================================
   RENDER SUMMARY
========================================================= */
function renderHandover(data) {
  document.getElementById("handoverSummary").innerHTML = `
    <div class="text-xs text-gray-500 mb-1">
      Submitted by <b>${data.submittedBy}</b> on ${data.submittedAt}
    </div>
    <div><b>RITMs:</b> ${data.ritms}</div>
    <div><b>Incidents:</b> ${data.incidents}</div>
    <div><b>Changes:</b> ${data.changes}</div>
    <div><b>Notes:</b> ${data.comments}</div>
    ${
      data.acknowledgedBy
        ? `<div class="text-green-700 mt-2">
             ‚úî Acknowledged by <b>${data.acknowledgedBy}</b>
             (${data.acknowledgedAt})
           </div>`
        : `<div class="text-yellow-700 mt-2">
             Awaiting acknowledgment
           </div>`
    }
  `;

  document.getElementById("ackBtn").classList.toggle(
    "hidden",
    !!data.acknowledgedBy
  );
}

/* =========================================================
   SUBMIT
========================================================= */
function submitHandover() {
  const data = {
    ritms: document.getElementById("handover-ritms").value,
    incidents: document.getElementById("handover-incidents").value,
    changes: document.getElementById("handover-changes").value,
    comments: document.getElementById("handover-comments").value,
    submittedBy: window.SSO_USER,
    submittedAt: new Date().toLocaleString(),
    acknowledgedBy: "",
    acknowledgedAt: ""
  };

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* =========================================================
   ACKNOWLEDGE
========================================================= */
function acknowledgeHandover() {
  const data = JSON.parse(localStorage.getItem("handoverData"));
  if (!data) return;

  data.acknowledgedBy = window.SSO_USER;
  data.acknowledgedAt = new Date().toLocaleString();

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* =========================================================
   INIT
========================================================= */
window.onload = loadHandover;
</script>



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Handover Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">

<!-- =========================================================
  CHANGE: SSO USER (replace later from backend if needed)
========================================================= -->
<script>
  // Simulated SSO user (today this comes from Flask/Jenkins headers)
  window.SSO_USER = "John Doe";
</script>

<!-- =========================================================
  HANDOVER SUMMARY (UPPER BOX)
========================================================= -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h2 class="font-bold mb-2">Current Handover</h2>
  <div id="handoverSummary" class="text-sm text-gray-700">
    No handover submitted
  </div>

  <button id="ackBtn"
          onclick="acknowledgeHandover()"
          class="mt-3 px-3 py-1 bg-green-600 text-white rounded hidden">
    Acknowledge
  </button>
</div>

<!-- =========================================================
  HANDOVER FORM
========================================================= -->
<div class="bg-white p-4 rounded shadow">
  <h2 class="font-bold mb-3">Submit Handover</h2>

  <input id="handover-ritms" class="w-full border p-2 mb-2" placeholder="RITMs">
  <input id="handover-incidents" class="w-full border p-2 mb-2" placeholder="Incidents">
  <input id="handover-changes" class="w-full border p-2 mb-2" placeholder="Changes">
  <textarea id="handover-comments" class="w-full border p-2 mb-2" placeholder="Comments"></textarea>

  <button onclick="submitHandover()"
          class="px-4 py-2 bg-blue-600 text-white rounded">
    Submit Handover
  </button>
</div>

<!-- =========================================================
  JAVASCRIPT LOGIC (ALL IN ONE PLACE)
========================================================= -->
<script>
/* ---------------------------------------------------------
  DEFAULT STRUCTURE
--------------------------------------------------------- */
const DEFAULT_HANDOVER = {
  ritms: "",
  incidents: "",
  changes: "",
  comments: "",
  submittedBy: "",
  submittedAt: "",
  acknowledgedBy: "",
  acknowledgedAt: ""
};

/* ---------------------------------------------------------
  LOAD HANDOVER ON PAGE LOAD
--------------------------------------------------------- */
function loadHandover() {
  const saved = localStorage.getItem("handoverData");
  const data = saved ? JSON.parse(saved) : DEFAULT_HANDOVER;

  document.getElementById("handover-ritms").value = data.ritms;
  document.getElementById("handover-incidents").value = data.incidents;
  document.getElementById("handover-changes").value = data.changes;
  document.getElementById("handover-comments").value = data.comments;

  renderHandover(data);
}

/* ---------------------------------------------------------
  RENDER UPPER SUMMARY ONLY
--------------------------------------------------------- */
function renderHandover(data) {
  const acknowledgedBlock = data.acknowledgedBy
    ? `<div class="text-green-700 mt-2">
         ‚úî Acknowledged by <b>${data.acknowledgedBy}</b>
         <span class="text-xs">(${data.acknowledgedAt})</span>
       </div>`
    : `<div class="text-yellow-700 mt-2">
         Awaiting acknowledgment
       </div>`;

  document.getElementById("handoverSummary").innerHTML = `
    <div class="text-xs text-gray-500 mb-1">
      Submitted by <b>${data.submittedBy || "-"}</b>
      on ${data.submittedAt || "-"}
    </div>
    <div><b>RITMs:</b> ${data.ritms}</div>
    <div><b>Incidents:</b> ${data.incidents}</div>
    <div><b>Changes:</b> ${data.changes}</div>
    <div><b>Notes:</b> ${data.comments}</div>
    ${acknowledgedBlock}
  `;

  // Show acknowledge button only if not yet acknowledged
  document.getElementById("ackBtn").classList.toggle(
    "hidden",
    !!data.acknowledgedBy
  );
}

/* ---------------------------------------------------------
  SUBMIT HANDOVER
--------------------------------------------------------- */
function submitHandover() {
  const data = {
    ritms: document.getElementById("handover-ritms").value,
    incidents: document.getElementById("handover-incidents").value,
    changes: document.getElementById("handover-changes").value,
    comments: document.getElementById("handover-comments").value,

    // CHANGE: who submitted + when
    submittedBy: window.SSO_USER,
    submittedAt: new Date().toLocaleString(),

    acknowledgedBy: "",
    acknowledgedAt: ""
  };

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* ---------------------------------------------------------
  ACKNOWLEDGE HANDOVER
--------------------------------------------------------- */
function acknowledgeHandover() {
  const data = JSON.parse(localStorage.getItem("handoverData"));
  if (!data) return;

  // CHANGE: who acknowledged + when
  data.acknowledgedBy = window.SSO_USER;
  data.acknowledgedAt = new Date().toLocaleString();

  localStorage.setItem("handoverData", JSON.stringify(data));
  renderHandover(data);
}

/* ---------------------------------------------------------
  INIT
--------------------------------------------------------- */
window.onload = loadHandover;
</script>

</body>
</html>










<script>
/* CHANGE: Render summary box (SYNTAX FIXED) */
function renderHandover(data) {
    const summary = document.getElementById("handoverSummary");

    let acknowledgedHtml = "";
    if (data.acknowledgedBy) {
        acknowledgedHtml = `
            <div class="mt-1 text-green-700">
                <b>Acknowledged By:</b> ${data.acknowledgedBy}<br>
                <b>Acknowledged At:</b> ${data.acknowledgedAt}
            </div>
        `;
    }

    summary.innerHTML = `
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
        <hr class="my-2">
        <div><b>Submitted By:</b> ${data.submittedBy}</div>
        <div><b>Submitted At:</b> ${data.submittedAt}</div>
        ${acknowledgedHtml}
    `;

    // Show acknowledge button only if NOT acknowledged
    document.getElementById("ackBtn").classList.toggle(
        "hidden",
        !!data.acknowledgedBy
    );
}
</script>






<script>
<script>
/* CHANGE: Load saved handover on page load */
function loadHandover() {
    const data = JSON.parse(localStorage.getItem("handoverData"));
    if (data) {
        renderHandover(data);

        // Fill form with existing data
        document.getElementById("handover-ritms").value = data.ritms;
        document.getElementById("handover-incidents").value = data.incidents;
        document.getElementById("handover-changes").value = data.changes;
        document.getElementById("handover-comments").value = data.comments;
    }
}


/* CHANGE: Render summary box */
function renderHandover(data) {
    const summary = document.getElementById("handoverSummary");

    summary.innerHTML = `
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
        <hr class="my-2">
        <div><b>Submitted By:</b> ${data.submittedBy}</div>
        <div><b>Submitted At:</b> ${data.submittedAt}</div>
        ${
            data.acknowledgedBy
            ? `<div class="mt-1 text-green-700"><b>Acknowledged By:</b> ${data.acknowledgedBy}
               <br><b>Acknowledged At:</b> ${data.acknowledgedAt}</div>`
            : ""
        }
    `;

    // Show acknowledge button only if not acknowledged
    document.getElementById("ackBtn").classList.toggle(
        "hidden",
        !!data.acknowledgedBy
    );
}


/* CHANGE: Submit handover */
function submitHandover() {
    const username =
        document.getElementById("loggedInUser").dataset.username;

    const data = {
        ritms: document.getElementById("handover-ritms").value,
        incidents: document.getElementById("handover-incidents").value,
        changes: document.getElementById("handover-changes").value,
        comments: document.getElementById("handover-comments").value,

        submittedBy: username,                  // FIXED
        submittedAt: new Date().toLocaleString(),

        acknowledgedBy: "",
        acknowledgedAt: ""
    };

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}


/* CHANGE: Acknowledge handover */
function acknowledgeHandover() {
    const data = JSON.parse(localStorage.getItem("handoverData"));
    if (!data) return;

    data.acknowledgedBy =
        document.getElementById("loggedInUser").dataset.username;  // FIXED
    data.acknowledgedAt = new Date().toLocaleString();

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}


/* CHANGE: Auto-load on refresh */
window.addEventListener("DOMContentLoaded", loadHandover);
</script>
















/* CHANGE: Load saved handover on page load */
function loadHandover() {
    const data = JSON.parse(localStorage.getItem("handoverData"));
    if (data) {
        renderHandover(data);

        // Fill form with existing data
        document.getElementById("handover-ritms").value = data.ritms;
        document.getElementById("handover-incidents").value = data.incidents;
        document.getElementById("handover-changes").value = data.changes;
        document.getElementById("handover-comments").value = data.comments;
    }
}


/* CHANGE: Render summary box */
function renderHandover(data) {
    const summary = document.getElementById("handoverSummary");

    summary.innerHTML = `
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
        <hr class="my-2">
        <div><b>Submitted By:</b> ${data.submittedBy}</div>
        <div><b>Submitted At:</b> ${data.submittedAt}</div>
        ${
            data.acknowledgedBy
            ? `<div class="mt-1 text-green-700"><b>Acknowledged By:</b> ${data.acknowledgedBy}
               <br><b>Acknowledged At:</b> ${data.acknowledgedAt}</div>`
            : ""
        }
    `;

    // Show acknowledge button only if not acknowledged
    document.getElementById("ackBtn").classList.toggle(
        "hidden",
        !!data.acknowledgedBy
    );
}


/* CHANGE: Submit handover */
function submitHandover() {
    const username =
        document.getElementById("loggedInUser").dataset.username;

    const data = {
        ritms: document.getElementById("handover-ritms").value,
        incidents: document.getElementById("handover-incidents").value,
        changes: document.getElementById("handover-changes").value,
        comments: document.getElementById("handover-comments").value,

        submittedBy: username,                  // FIXED
        submittedAt: new Date().toLocaleString(),

        acknowledgedBy: "",
        acknowledgedAt: ""
    };

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}


/* CHANGE: Acknowledge handover */
function acknowledgeHandover() {
    const data = JSON.parse(localStorage.getItem("handoverData"));
    if (!data) return;

    data.acknowledgedBy =
        document.getElementById("loggedInUser").dataset.username;  // FIXED
    data.acknowledgedAt = new Date().toLocaleString();

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}


/* CHANGE: Auto-load on refresh */
window.addEventListener("DOMContentLoaded", loadHandover);
</script>





<script>
/* CHANGE START: Support Team Handover with Submit + Acknowledge */

/* Mock SSO user (replace later with real SSO) */
window.SSO_USER = window.SSO_USER || "john.doe@bnpparibas.com";

/* Default handover data */
const DEFAULT_HANDOVER = {
    ritms: "RITM0012345 - Pending QA signoff",
    incidents: "INC0098765 - Jenkins monitoring",
    changes: "CHG005544 - Artifactory upgrade at 2 AM",
    comments: "Check PR queue and Sonar DB memory",
    submittedBy: "System",
    submittedAt: "Initial load",
    acknowledgedBy: "",
    acknowledgedAt: ""
};

/* Load handover on page load */
function loadHandover() {
    const saved = localStorage.getItem("handoverData");
    const data = saved ? JSON.parse(saved) : DEFAULT_HANDOVER;

    // Fill textboxes
    document.getElementById("handover-ritms").value = data.ritms;
    document.getElementById("handover-incidents").value = data.incidents;
    document.getElementById("handover-changes").value = data.changes;
    document.getElementById("handover-comments").value = data.comments;

    renderHandover(data);
}

/* Render summary box */
function renderHandover(data) {
    const acknowledged = data.acknowledgedBy
        ? `<div class="text-green-700 mt-2">
              ‚úî Acknowledged by <b>${data.acknowledgedBy}</b>
              <br><span class="text-xs">${data.acknowledgedAt}</span>
           </div>`
        : `<div class="text-yellow-700 mt-2">
              ‚è≥ Awaiting acknowledgment
           </div>`;

    document.getElementById("handover-default-display").innerHTML = `
        <div class="text-xs text-gray-500 mb-1">
            Submitted by <b>${data.submittedBy}</b> on ${data.submittedAt}
        </div>
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
        ${acknowledged}
    `;

    // Show acknowledge button only if not acknowledged
    document.getElementById("ackBtn").classList.toggle(
        "hidden",
        !!data.acknowledgedBy
    );
}

/* Submit handover */
function submitHandover() {
    const data = {
        ritms: document.getElementById("handover-ritms").value,
        incidents: document.getElementById("handover-incidents").value,
        changes: document.getElementById("handover-changes").value,
        comments: document.getElementById("handover-comments").value,
        submittedBy: window.SSO_USER,
        submittedAt: new Date().toLocaleString(),
        acknowledgedBy: "",
        acknowledgedAt: ""
    };

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}

/* Acknowledge handover */
function acknowledgeHandover() {
    const data = JSON.parse(localStorage.getItem("handoverData"));
    data.acknowledgedBy = window.SSO_USER;
    data.acknowledgedAt = new Date().toLocaleString();

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}

/* Auto load */
window.addEventListener("DOMContentLoaded", loadHandover);

/* CHANGE END */
</script>






<!-- CHANGE START: Acknowledge button -->
<div class="text-right mb-4">
    <button id="ackBtn"
            onclick="acknowledgeHandover()"
            class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 hidden">
        Acknowledge Handover
    </button>
</div>
<!-- CHANGE END -->



<script>
/* CHANGE START: Handover logic */

/* Default handover data */
const DEFAULT_HANDOVER = {
    ritms: "RITM0012345 - Pending QA signoff",
    incidents: "INC0098765 - Jenkins slave monitoring",
    changes: "CHG005544 - Artifactory upgrade at 2 AM",
    comments: "Check Bitbucket PR queue and Sonar DB memory",
    updatedAt: "Initial load"
};

/* Load on page open */
function loadHandover() {
    const saved = localStorage.getItem("handoverData");
    const data = saved ? JSON.parse(saved) : DEFAULT_HANDOVER;

    // Fill textboxes
    document.getElementById("handover-ritms").value = data.ritms;
    document.getElementById("handover-incidents").value = data.incidents;
    document.getElementById("handover-changes").value = data.changes;
    document.getElementById("handover-comments").value = data.comments;

    // Update upper display
    renderHandover(data);
}

/* Update upper display only */
function renderHandover(data) {
    document.getElementById("handover-default-display").innerHTML = `
        <div class="text-xs text-gray-500 mb-1">
            Last Updated: ${data.updatedAt}
        </div>
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
    `;
}

/* Submit handover */
function submitHandover() {
    const data = {
        ritms: document.getElementById("handover-ritms").value,
        incidents: document.getElementById("handover-incidents").value,
        changes: document.getElementById("handover-changes").value,
        comments: document.getElementById("handover-comments").value,
        updatedAt: new Date().toLocaleString()
    };

    localStorage.setItem("handoverData", JSON.stringify(data));
    renderHandover(data);
}

/* AUTO LOAD */
window.addEventListener("DOMContentLoaded", loadHandover);

/* CHANGE END */
</script>





<!-- 2. Middle Section: Dynamic Views Container (3/6 width) -->
<section class="lg:col-span-3">

    <!-- CHANGE START: App container -->
    <div id="app-frame-container" class="hidden bg-white rounded-xl shadow-lg p-4">

        <!-- CHANGE START: Top header with Back button -->
        <div class="flex justify-end mb-3">
            <button onclick="backToDashboard()"
                    class="px-4 py-2 bg-bnpp-primary text-white font-medium rounded-lg shadow hover:bg-bnpp-dark transition duration-200">
                ‚Üê Back to Dashboard
            </button>
        </div>
        <!-- CHANGE END -->

        <!-- Embedded application iframe -->
        <iframe
            id="appFrame"
            name="appFrame"
            class="w-full h-[75vh] rounded-xl"
            frameborder="0">
        </iframe>

    </div>
    <!-- CHANGE END -->

</section>




<script>
/* CHANGE START: Initial fallback data */
const DEFAULT_HANDOVER = {
    ritms: "RITM0012345 - Pending QA signoff",
    incidents: "INC0098765 - Jenkins slave monitoring",
    changes: "CHG005544 - Artifactory upgrade at 2 AM",
    comments: "Check Bitbucket PR queue and Sonar DB memory"
};
/* CHANGE END */

/* CHANGE START: Load and render handover */
function loadHandover() {

    // Load saved handover or default
    const data = JSON.parse(localStorage.getItem("handoverData")) || DEFAULT_HANDOVER;

    // Fill textboxes
    document.getElementById("handover-ritms").value = data.ritms;
    document.getElementById("handover-incidents").value = data.incidents;
    document.getElementById("handover-changes").value = data.changes;
    document.getElementById("handover-comments").value = data.comments;

    // Update ONLY the upper display box
    renderHandover(data);
}
/* CHANGE END */

/* CHANGE START: Render data in upper box */
function renderHandover(data) {
    document.getElementById("handover-default-display").innerHTML = `
        <strong>Current Handover:</strong>
        <div><b>RITMs:</b> ${data.ritms}</div>
        <div><b>Incidents:</b> ${data.incidents}</div>
        <div><b>Changes:</b> ${data.changes}</div>
        <div><b>Notes:</b> ${data.comments}</div>
    `;
}
/* CHANGE END */

/* CHANGE START: Submit handler updates upper box only */
function submitHandover() {

    // Read updated values from inputs
    const data = {
        ritms: document.getElementById("handover-ritms").value.trim(),
        incidents: document.getElementById("handover-incidents").value.trim(),
        changes: document.getElementById("handover-changes").value.trim(),
        comments: document.getElementById("handover-comments").value.trim()
    };

    // Persist updated handover
    localStorage.setItem("handoverData", JSON.stringify(data));

    // Update ONLY the upper box
    renderHandover(data);
}
/* CHANGE END */

/* CHANGE START: Auto-load on page open */
document.addEventListener("DOMContentLoaded", loadHandover);
/* CHANGE END */
</script>





<!-- CHANGE START: Single handover display box -->
<div id="handover-default-display"
     class="mb-4 bg-blue-50 border-l-4 border-blue-500 p-3 rounded-lg text-sm space-y-1">
</div>
<!-- CHANGE END -->




<script>
/* CHANGE START: Capture handover data and display it below submit button */
function submitHandover() {

    // Read values from handover textareas
    const ritms = document.getElementById("handover-ritms").value.trim();
    const incidents = document.getElementById("handover-incidents").value.trim();
    const changes = document.getElementById("handover-changes").value.trim();
    const comments = document.getElementById("handover-comments").value.trim();

    // Validation: Prevent empty submission
    if (!ritms && !incidents && !changes && !comments) {
        alert("Please fill at least one handover field.");
        return;
    }

    // Get the output container
    const output = document.getElementById("handover-output");

    // Make output visible after submit
    output.classList.remove("hidden");

    // Populate submitted handover data
    output.innerHTML = `
        <div>
            <strong>RITMs / SRs:</strong>
            <p>${ritms || "‚Äî"}</p>
        </div>

        <div>
            <strong>Incidents:</strong>
            <p>${incidents || "‚Äî"}</p>
        </div>

        <div>
            <strong>Changes:</strong>
            <p>${changes || "‚Äî"}</p>
        </div>

        <div>
            <strong>Next Shift Notes:</strong>
            <p>${comments || "‚Äî"}</p>
        </div>

        <!-- Timestamp for tracking handover -->
        <div class="text-xs text-gray-500 mt-2">
            Submitted at ${new Date().toLocaleString()}
        </div>
    `;
}
/* CHANGE END */
</script>




<style>
    .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px; /* üëà GAP BETWEEN CARDS */
        margin-top: 20px;
    }

    .status-card {
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        background: #fff;
    }

    .status-card.pass {
        background: #e6f7ec;
        border-left: 6px solid #22c55e;
        color: #15803d;
    }

    .status-card.fail {
        background: #fde8e8;
        border-left: 6px solid #ef4444;
        color: #b91c1c;
    }

    .status-title {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
    }

    .status-value {
        font-size: 18px;
        font-weight: bold;
        margin-top: 6px;
    }
</style>

<div class="status-grid">
    <div class="status-card pass">
        <div class="status-title">CLI Check</div>
        <div class="status-value">PASS</div>
    </div>

    <div class="status-card fail">
        <div class="status-title">UI Check</div>
        <div class="status-value">FAIL</div>
    </div>
</div>






<style>
    .status-card.pass {
        background: #e6f7ec;
        border-left: 6px solid #22c55e;
        color: #15803d;
    }

    .status-card.fail {
        background: #fde8e8;
        border-left: 6px solid #ef4444;
        color: #b91c1c;
    }
</style>

<div class="status-grid">
    <div class="status-card pass">
        <div class="status-title">CLI Check</div>
        <div class="status-value">PASS</div>
    </div>

    <div class="status-card fail">
        <div class="status-title">UI Check</div>
        <div class="status-value">FAIL</div>
    </div>
</div>




<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-4">
    <!-- CLI Check Card -->
    <div class="p-4 bg-green-100 border-l-4 border-green-500 rounded shadow flex items-center justify-between">
        <div>
            <h3 class="text-sm font-semibold text-gray-700">CLI Check</h3>
            <p class="text-lg font-bold text-green-700">PASS</p>
        </div>
    </div>

    <!-- UI Check Card -->
    <div class="p-4 bg-green-100 border-l-4 border-green-500 rounded shadow flex items-center justify-between">
        <div>
            <h3 class="text-sm font-semibold text-gray-700">UI Check</h3>
            <p class="text-lg font-bold text-green-700">PASS</p>
        </div>
    </div>

    <!-- Cluster Check Card -->
    <div class="p-4 bg-green-100 border-l-4 border-green-500 rounded shadow flex items-center justify-between">
        <div>
            <h3 class="text-sm font-semibold text-gray-700">Cluster</h3>
            <p class="text-lg font-bold text-green-700">3 / 3</p>
        </div>
    </div>

    <!-- Certificate Expiry Card -->
    <div class="p-4 bg-green-100 border-l-4 border-green-500 rounded shadow flex items-center justify-between">
        <div>
            <h3 class="text-sm font-semibold text-gray-700">Certificate Expiry</h3>
            <p class="text-lg font-bold text-green-700">PASS</p>
        </div>
    </div>

    <!-- License Card -->
    <div class="p-4 bg-green-100 border-l-4 border-green-500 rounded shadow flex items-center justify-between">
        <div>
            <h3 class="text-sm font-semibold text-gray-700">License</h3>
            <p class="text-lg font-bold text-green-700">PASS</p>
        </div>
    </div>
</div>




<!-- CHANGE START: Center iframe control -->
<script>
    function openAppInCenter() {
        document.getElementById('dashboard-view').classList.add('hidden');
        document.getElementById('servicenow-details-view').classList.add('hidden');
        document.getElementById('app-frame-container').classList.remove('hidden');
    }

    function backToDashboard() {
        document.getElementById('app-frame-container').classList.add('hidden');
        document.getElementById('dashboard-view').classList.remove('hidden');
    }
</script>
<!-- CHANGE END -->




<!-- CHANGE START: iframe container for application pages -->
<div id="app-frame-container" class="hidden bg-white rounded-xl shadow-lg h-full">
    <iframe
        id="appFrame"
        name="appFrame"
        class="w-full h-[75vh] rounded-xl"
        frameborder="0">
    </iframe>

    <!-- Back to Dashboard button -->
    <div class="mt-4 text-right">
        <button onclick="backToDashboard()"
                class="text-sm font-medium text-bnpp-primary hover:underline">
            ‚Üê Back to Dashboard
        </button>
    </div>
</div>
<!-- CHANGE END -->




/* TOOLS */
.tools-box {
    background: #f2f2f2;
    padding: 15px;
    border-radius: 10px;
}

.tools-box ul {
    list-style: none;
    padding: 0;
}

.tools-box li a {
    display: block;
    padding: 6px 0;
    color: #0a5d32;
    font-weight: 500;
    text-decoration: none;
}

/* CENTER */
.big-center-box {
    background: #2f6f1f;
    padding: 15px;
    border-radius: 15px;
}

.inner-box {
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    min-height: 120px;
}

.inner-box h5 {
    color: #1b5e20;
    font-weight: bold;
    margin-bottom: 10px;
}

.inner-box a {
    display: block;
    color: #333;
    text-decoration: none;
    margin-bottom: 4px;
}

.inner-box a:hover {
    color: #1b5e20;
    text-decoration: underline;
}

/* SMALL HEIGHT BOX */
.small-height {
    min-height: 90px;
}

/* RIGHT */
.right-box {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 10px;
}






<div class="container-fluid mt-3">
    <div class="row justify-content-center">

        <!-- LEFT TOOLS -->
        <div class="col-md-2 tools-box">
            <h5>Tools</h5>
            <ul>
                <li><a href="#">Bitbucket</a></li>
                <li><a href="#">Artifactory</a></li>
                <li><a href="#">Jenkins</a></li>
                <li><a href="#">Sonarqube</a></li>
                <li><a href="#">Fortify</a></li>
                <li><a href="#">Tenable</a></li>
                <li><a href="#">Nexus</a></li>
            </ul>
        </div>

        <!-- CENTER BIG BOX -->
        <div class="col-md-6">
            <div class="big-center-box">

                <!-- Service Now -->
                <div class="inner-box">
                    <h5>Service Now</h5>
                    <a href="#">Incidents</a>
                    <a href="#">Requests</a>
                    <a href="#">Change Log</a>
                    <a href="#">Knowledge Base</a>
                </div>

                <!-- Monitoring -->
                <div class="inner-box">
                    <h5>Monitoring</h5>
                    <a href="#">Alerts</a>
                    <a href="#">Dashboards</a>
                    <a href="#">Metrics</a>
                    <a href="#">Reports</a>
                </div>

                <!-- DevSecOps Healthcheck -->
                <div class="inner-box small-height">
                    <h5>DevSecOps Healthcheck</h5>
                    <a href="#">Pipeline Status</a>
                    <a href="#">Security Scan</a>
                </div>

            </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="col-md-3">
            <div class="right-box">
                <h5>Select Date</h5>

                <input type="date" class="form-control mb-2">

                <!-- BLANK INPUT -->
                <input type="text" class="form-control mb-3" placeholder="Enter value">

                <button class="btn btn-success w-100 mb-2">Run</button>
                <button class="btn btn-danger w-100">Reset</button>
            </div>
        </div>

    </div>
</div>







.small-service-box {
    height: 180px !important;      /* adjust here */
    border-radius: 12px;
    background: #ffffff;
    box-shadow: 0 3px 10px rgba(0,0,0,0.10);
    padding: 15px;
    border: 1px solid #e5e5e5;
    display: block !important;
}

.small-service-box h5 {
    font-weight: bold;
    color: #007bff;
    margin-bottom: 10px;
}

.small-service-box p {
    margin: 4px 0;
    font-size: 15px;
}

/* Important fix: stop bootstrap equal height */
.center-row {
    align-items: flex-start !important;
}





<div class="col-md-7">

    <div style="background:white; padding:20px; border-radius:12px; 
                box-shadow:0px 4px 14px rgba(0,0,0,0.15);">

        <!-- Buttons row -->
        <div class="text-center mb-3">
            <button class="blue-btn">Dashboard</button>
            <button class="blue-btn">Metrics</button>
            <button class="blue-btn">Repositories</button>
            <button class="blue-btn">Quality Gates</button>
            <button class="blue-btn">Build History</button>
        </div>

        <!-- TWO SMALL BOXES INSIDE ONE BIG BOX -->
        <div class="row center-row">

            <!-- Service Now -->
            <div class="col-md-6">
                <div class="small-service-box">
                    <h5>Service Now</h5>
                    <p>Incidents</p>
                    <p>Requests</p>
                    <p>Change Log</p>
                    <p>Knowledge Base</p>
                </div>
            </div>

            <!-- Monitoring -->
            <div class="col-md-6">
                <div class="small-service-box">
                    <h5>Monitoring</h5>
                    <p>Alerts</p>
                    <p>Dashboards</p>
                    <p>Metrics</p>
                    <p>Reports</p>
                </div>
            </div>

        </div>

    </div>
</div>




<div class="col-md-7">

    <div class="big-wrapper" 
         style="background:white; padding:20px; border-radius:12px; 
                box-shadow:0 3px 8px rgba(0,0,0,0.15);">

        <!-- BLUE BUTTONS -->
        <div class="text-center mb-3">
            <button class="blue-btn">Dashboard</button>
            <button class="blue-btn">Metrics</button>
            <button class="blue-btn">Repositories</button>
            <button class="blue-btn">Quality Gates</button>
            <button class="blue-btn">Build History</button>
        </div>

        <div class="row justify-content-center">

            <!-- SERVICE NOW -->
            <div class="col-md-5">
                <div class="center-box"
                     style="height:180px; padding:12px; background:#f8fbff;
                            border:1px solid #dde7f7; border-radius:12px;
                            width:100%; margin:auto;">
                    <h5 class="center-section-title" style="font-size:18px; font-weight:bold;">
                        Service Now
                    </h5>

                    <p class="center-link">Incidents</p>
                    <p class="center-link">Requests</p>
                    <p class="center-link">Change Log</p>
                    <p class="center-link">Knowledge Base</p>
                </div>
            </div>

            <!-- MONITORING -->
            <div class="col-md-5">
                <div class="center-box"
                     style="height:180px; padding:12px; background:#f8fbff;
                            border:1px solid #dde7f7; border-radius:12px;
                            width:100%; margin:auto;">
                    <h5 class="center-section-title" style="font-size:18px; font-weight:bold;">
                        Monitoring
                    </h5>

                    <p class="center-link">Alerts</p>
                    <p class="center-link">Dashboards</p>
                    <p class="center-link">Metrics</p>
                    <p class="center-link">Reports</p>
                </div>
            </div>

        </div>
    </div>
</div>




<!-- CENTER DIVISION (WITH ONE BIG BOX) -->
<div class="col-md-7">

    <!-- BIG BOX START -->
    <div class="big-wrapper" 
         style="background:white; padding:20px; border-radius:12px; 
                box-shadow:0 3px 8px rgba(0,0,0,0.15);">

        <!-- BLUE BUTTONS ROW -->
        <div class="text-center mb-3">
            <button class="blue-btn">Dashboard</button>
            <button class="blue-btn">Metrics</button>
            <button class="blue-btn">Repositories</button>
            <button class="blue-btn">Quality Gates</button>
            <button class="blue-btn">Build History</button>
        </div>

        <!-- ROW OF TWO BOXES -->
        <div class="row">

            <!-- SERVICE NOW BOX -->
            <div class="col-md-6">
                <div class="center-box" 
                     style="height: 300px; background:#f8fbff; 
                            padding:15px; border-radius:10px;
                            border:1px solid #dce7ff;">
                    <h5 class="center-section-title">Service Now</h5>
                    <p class="center-link">Incidents</p>
                    <p class="center-link">Requests</p>
                    <p class="center-link">Change Log</p>
                    <p class="center-link">Knowledge Base</p>
                </div>
            </div>

            <!-- MONITORING BOX -->
            <div class="col-md-6">
                <div class="center-box" 
                     style="height: 300px; background:#f8fbff; 
                            padding:15px; border-radius:10px;
                            border:1px solid #dce7ff;">
                    <h5 class="center-section-title">Monitoring</h5>
                    <p class="center-link">Alerts</p>
                    <p class="center-link">Dashboards</p>
                    <p class="center-link">Metrics</p>
                    <p class="center-link">Reports</p>
                </div>
            </div>

        </div>

    </div>
    <!-- BIG BOX END -->

</div>




<!-- CENTER DIVISION (WITH TWO BOXES) -->
<div class="col-md-7">

    <!-- BLUE BUTTONS ROW -->
    <div class="text-center mb-3">
        <button class="blue-btn">Dashboard</button>
        <button class="blue-btn">Metrics</button>
        <button class="blue-btn">Repositories</button>
        <button class="blue-btn">Quality Gates</button>
        <button class="blue-btn">Build History</button>
    </div>

    <div class="row">

        <!-- SERVICE NOW BOX -->
        <div class="col-md-6">
            <div class="center-box" style="height: 300px;">
                <h5 class="center-section-title">Service Now</h5>
                <p class="center-link">Incidents</p>
                <p class="center-link">Requests</p>
                <p class="center-link">Change Log</p>
                <p class="center-link">Knowledge Base</p>
            </div>
        </div>

        <!-- MONITORING BOX -->
        <div class="col-md-6">
            <div class="center-box" style="height: 300px;">
                <h5 class="center-section-title">Monitoring</h5>
                <p class="center-link">Alerts</p>
                <p class="center-link">Dashboards</p>
                <p class="center-link">Metrics</p>
                <p class="center-link">Reports</p>
            </div>
        </div>

    </div>
</div>




<style>
    /* LEFT LINKS */
    .left-link {
        text-decoration: none;
        color: #007bff;
        font-size: 15px;
        display: block;
        padding: 5px 0;
    }
    .left-link:hover {
        text-decoration: underline;
    }

    /* BLUE BUTTONS */
    .blue-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 14px;
        margin: 4px;
        border-radius: 5px;
        font-size: 14px;
        cursor: pointer;
    }

    /* CENTER WHITE PANEL */
    .center-box {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        min-height: 350px;
    }

    /* SECTION TITLES (blue like screenshot) */
    .center-section-title {
        font-weight: bold;
        color: #007bff;
        margin-bottom: 15px;
        font-size: 18px;
    }

    /* LINKS INSIDE CENTER */
    .center-link {
        color: black;
        margin: 5px 0;
        font-size: 15px;
    }
    .center-link:hover {
        color: #007bff;
        text-decoration: underline;
    }

    /* RIGHT BUTTONS */
    .run-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 6px;
        font-size: 16px;
    }

    .reset-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 6px;
        font-size: 16px;
        margin-left: 10px;
    }
</style>



<div class="container-fluid" style="padding-top: 30px; padding-bottom:50px;">

    <div class="row justify-content-center">

        <!-- LEFT DIVISION (SMALL WIDTH) -->
        <div class="col-md-2">
            <div style="background:#f0f0f0; padding:15px; border-radius:10px;">
                <h4 style="text-align:center; font-weight:bold;">Tools</h4>

                <ul style="list-style:none; padding-left:0; margin-top:20px;">
                    <li><a class="left-link" href="#">Link 1</a></li>
                    <li><a class="left-link" href="#">Link 2</a></li>
                    <li><a class="left-link" href="#">Link 3</a></li>
                    <li><a class="left-link" href="#">Link 4</a></li>
                    <li><a class="left-link" href="#">Link 5</a></li>
                    <li><a class="left-link" href="#">Link 6</a></li>
                    <li><a class="left-link" href="#">Link 7</a></li>
                    <li><a class="left-link" href="#">Link 8</a></li>
                    <li><a class="left-link" href="#">Link 9</a></li>
                    <li><a class="left-link" href="#">Link 10</a></li>
                </ul>
            </div>
        </div>



        <!-- CENTER DIVISION (EXACT SCREENSHOT STYLE) -->
        <div class="col-md-7">

            <!-- BLUE BUTTONS ROW -->
            <div class="text-center mb-3">
                <button class="blue-btn">Dashboard</button>
                <button class="blue-btn">Metrics</button>
                <button class="blue-btn">Repositories</button>
                <button class="blue-btn">Quality Gates</button>
                <button class="blue-btn">Build History</button>
            </div>

            <!-- MAIN WHITE BOX -->
            <div class="center-box">

                <div class="row">

                    <!-- SERVICE NOW SECTION -->
                    <div class="col-md-6 text-center">
                        <h5 class="center-section-title">Service Now</h5>
                        <p class="center-link">Incidents</p>
                        <p class="center-link">Requests</p>
                        <p class="center-link">Change Log</p>
                        <p class="center-link">Knowledge Base</p>
                    </div>

                    <!-- MONITORING SECTION -->
                    <div class="col-md-6 text-center">
                        <h5 class="center-section-title">Monitoring</h5>
                        <p class="center-link">Alerts</p>
                        <p class="center-link">Dashboards</p>
                        <p class="center-link">Metrics</p>
                        <p class="center-link">Reports</p>
                    </div>

                </div>

            </div>

        </div>



        <!-- RIGHT DIVISION (DATE PICKER + BUTTONS) -->
        <div class="col-md-3">
            <div style="background:#f0f0f0; padding:20px; border-radius:10px;">

                <h4 style="text-align:center; font-weight:bold;">Select Date</h4>

                <input type="date" class="form-control" style="margin-top:15px;">

                <div class="text-center" style="margin-top:20px;">
                    <button class="run-btn">Run</button>
                    <button class="reset-btn">Reset</button>
                </div>

            </div>
        </div>

    </div>
</div>









<div class="container-fluid" style="padding-top: 30px;">

    <div class="row">

        <!-- LEFT DIVISION WITH 10 LINKS -->
        <div class="col-md-3">
            <div style="background:#f0f0f0; padding:20px; border-radius:10px;">

                <h4 style="text-align:center; font-weight:bold;">Quick Links</h4>

                <ul style="list-style-type:none; padding-left:0; margin-top:20px;">

                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 1</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 2</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 3</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 4</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 5</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 6</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 7</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 8</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 9</a>
                    </li>
                    <li style="margin-bottom:10px;">
                        <a href="#" style="text-decoration:none; color:#007bff; font-size:16px;">Link 10</a>
                    </li>

                </ul>

            </div>
        </div>

        <!-- CENTER DIVISION -->
        <div class="col-md-6">

            <!-- TOP BIG BOX -->
            <div class="big-box"
                 style="padding:25px; margin-bottom:30px; border-radius:10px;
                        background:#ffffff; box-shadow:0px 0px 10px rgba(0,0,0,0.1);">

                <h4 style="text-align:center; font-weight:bold; margin-bottom:25px;">
                    Monitoring Tools
                </h4>

                <div class="row">

                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold;">
                            ServiceNow Dashboard
                        </a>
                    </div>

                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold;">
                            Jira Dashboard
                        </a>
                    </div>

                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold;">
                            Dynatrace Alerts
                        </a>
                    </div>

                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold;">
                            OpenSearch
                        </a>
                    </div>

                </div>
            </div>

            <!-- BOTTOM BIG BOX -->
            <div class="big-box"
                 style="padding:25px; border-radius:10px;
                        background:#ffffff; box-shadow:0px 0px 10px rgba(0,0,0,0.1);">

                <h4 style="text-align:center; font-weight:bold; margin-bottom:25px;">
                    Additional Tool
                </h4>

                <div class="row">
                    <div class="col-md-12">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold;">
                            Single Tool Box
                        </a>
                    </div>
                </div>

            </div>

        </div>

        <!-- RIGHT DIVISION -->
        <div class="col-md-3">
            <div style="background:#f0f0f0; padding:20px; border-radius:10px;">
                <h4 style="text-align:center; font-weight:bold;">Right Division</h4>
            </div>
        </div>

    </div>
</div>




<div class="container-fluid" style="height: 100%; padding-top: 30px;">

    <div class="row">

        <!-- LEFT DIVISION -->
        <div class="col-md-3">
            <div style="background:#f0f0f0; padding:20px; border-radius:10px; height:100%;">
                <h4 style="text-align:center; font-weight:bold;">Left Division</h4>
            </div>
        </div>

        <!-- CENTER BIG BOX -->
        <div class="col-md-6">
            <div class="big-box"
                 style="padding:25px; border-radius:10px; background:#ffffff; box-shadow:0px 0px 10px rgba(0,0,0,0.1);">

                <h4 style="text-align:center; font-weight:bold; margin-bottom:25px;">
                    Monitoring Tools
                </h4>

                <div class="row">

                    <!-- Small Box 1 -->
                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold; text-decoration:none;">
                            ServiceNow Dashboard
                        </a>
                    </div>

                    <!-- Small Box 2 -->
                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold; text-decoration:none;">
                            Jira Dashboard
                        </a>
                    </div>

                    <!-- Small Box 3 -->
                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold; text-decoration:none;">
                            Dynatrace Alerts
                        </a>
                    </div>

                    <!-- Small Box 4 -->
                    <div class="col-md-6">
                        <a href="#" class="small-box"
                           style="display:block; padding:20px; border-radius:10px;
                                  background:#eaf6ff; margin-bottom:20px; text-align:center;
                                  color:black; font-size:18px; font-weight:bold; text-decoration:none;">
                            OpenSearch
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <!-- RIGHT DIVISION -->
        <div class="col-md-3">
            <div style="background:#f0f0f0; padding:20px; border-radius:10px; height:100%;">
                <h4 style="text-align:center; font-weight:bold;">Right Division</h4>
            </div>
        </div>

    </div>
</div>








<div class="small-box">
    <a href="/devsecops" target="_blank" 
       style="display:block; padding:15px; background:linear-gradient(135deg, #1EBC3A, #0E8F27);
              border-radius:10px; text-align:center; color:white; font-weight:bold; 
              font-size:18px; text-decoration:none; box-shadow:0 4px 8px rgba(0,0,0,0.2);">
        DevSecOps Health Checks
    </a>
</div>





iframe.srcdoc = `
<html>
<head>
<style>
    body, html {
        margin: 0;
        padding: 10px;
        width: 100%;
        overflow-x: hidden !important;
        font-family: Arial;
    }

    .report-wrapper {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box;
    }

    table {
        width: 100% !important;
        max-width: 100% !important;
        table-layout: fixed !important;
        border-collapse: collapse;
    }

    td, th {
        border: 1px solid black;
        padding: 5px;
        word-wrap: break-word !important;
        white-space: normal !important;
    }
</style>
</head>
<body>
    <h4 style="color:#1EBC3A;">Report for ${date} at ${hour}</h4>
    <div class="report-wrapper">
        ${data.report_html}
    </div>
</body>
</html>`;





<script>

function fetchHours() {
    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hourDropdown = document.getElementById("selected_time");

    hourDropdown.innerHTML = "<option>Loading...</option>";

    if (!env || !date) {
        hourDropdown.innerHTML = "<option>-- Select Hour --</option>";
        return;
    }

    fetch("/get-hours", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ env: env, date: date })
    })
    .then(res => res.json())
    .then(data => {
        hourDropdown.innerHTML = "";
        if (!data || data.length === 0) {
            hourDropdown.innerHTML = "<option>No hours available</option>";
            return;
        }
        data.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = h;
            hourDropdown.appendChild(opt);
        });
    })
    .catch(err => {
        console.error("Error:", err);
        hourDropdown.innerHTML = "<option>Error loading hours</option>";
    });
}



function loadReport(event) {
    event.preventDefault();

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;
    const iframe = document.getElementById("report-frame");

    // Show loading
    iframe.srcdoc = "<p style='padding:20px;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(response => response.json())
    .then(data => {

        if (data.success) {

            iframe.srcdoc = `
            <html>
            <head>
            <style>
                body { margin:0; padding:10px; font-family:Arial; overflow-x:hidden; }
                .report-wrapper { width:100%; white-space:pre-wrap; }
                table { width:100%; border-collapse:collapse; }
                td, th { border:1px solid black; padding:5px; }
            </style>
            </head>
            <body>
                <h4 style="color:#1EBC3A;">Report for ${date} at ${hour}</h4>
                <div class="report-wrapper">
                    ${data.report_html}
                </div>
            </body>
            </html>`;
        }
        else {
            iframe.srcdoc = `<p style='color:red; padding:20px;'>${data.error}</p>`;
        }
    })
    .catch(error => {
        console.error("Error:", error);
        iframe.srcdoc = "<p style='color:red; padding:20px;'>Error loading report.</p>";
    });
}



function resizeIframe(iframe) {
    try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        iframe.style.height = doc.body.scrollHeight + "px";
    } catch (e) {
        console.error(e);
    }
}

</script>





const iframe = document.getElementById("report-frame");

iframe.srcdoc = `
<html>
<head>
<style>
  body {
     margin: 0;
     padding: 0;
     overflow-x: hidden;
     font-family: Arial;
  }
  .report-wrapper {
     width: 100%;
     padding: 15px;
     box-sizing: border-box;
     background: white;
     white-space: pre-wrap;
  }
  table {
     width: 100% !important;
     border-collapse: collapse;
  }
  td, th {
     border: 1px solid black;
     padding: 5px;
  }
</style>
</head>
<body>
  <div class="report-wrapper">
     <h3 style="color:#1EBC3A;">Report for ${date} at ${hour}</h3>
     ${data.report_html}
  </div>
</body>
</html>
`;


<!DOCTYPE html>
<html>
<head>
    <title>SOD Checks</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
</head>

<body style="background:#222;">

<div style="background:#f2f2f2; padding:20px; margin:70px 100px;">
    <h2 style="color:#1E8C3A;">SOD Checks</h2>

    <form id="sodForm" onsubmit="loadReport(event)">
        <div class="row g-3 align-items-end">

            <div class="col-md-3">

                <!-- ENVIRONMENT -->
                <label class="fw-bold">Select Environment:</label>
                <select id="environment" class="form-control mb-3" onchange="fetchHours()" required>
                    <option value="">-- Select Environment --</option>
                    <option value="prd">PRD</option>
                    <option value="stg">STG</option>
                </select>

                <!-- DATE -->
                <label class="fw-bold">Select Date:</label>
                <input type="date" id="selected_date" class="form-control mb-3"
                    onchange="fetchHours()" required>

                <!-- HOUR -->
                <label class="fw-bold">Select Hour:</label>
                <select id="selected_time" class="form-control mb-3" required>
                    <option value="">-- Select Hour --</option>
                </select>

            </div>
        </div>

        <button type="submit"
            style="display:block; width:100%; background:#1EBC3A; color:white; padding:10px; border:none; font-size:16px; margin-top:10px;">
            Load Data
        </button>
    </form>

    <!-- REPORT SECTION -->
    <div id="report-area" class="mt-4" style="color:white;">
        <p class="text-muted">No report loaded.</p>
    </div>

</div>


<!-- ================= JS SECTION ================= -->

<script>

function fetchHours() {
    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hourDropdown = document.getElementById("selected_time");

    hourDropdown.innerHTML = "<option>Loading...</option>";

    if (!env || !date) {
        hourDropdown.innerHTML = "<option>-- Select Hour --</option>";
        return;
    }

    fetch("/get-hours", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ env: env, date: date })
    })
    .then(res => res.json())
    .then(data => {
        hourDropdown.innerHTML = "";
        if (!data || data.length === 0) {
            hourDropdown.innerHTML = "<option>No hours available</option>";
            return;
        }
        data.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = h;
            hourDropdown.appendChild(opt);
        });
    })
    .catch(err => {
        console.error("Error:", err);
        hourDropdown.innerHTML = "<option>Error loading hours</option>";
    });
}



function loadReport(event) {
    event.preventDefault();

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;
    const reportArea = document.getElementById("report-area");

    reportArea.innerHTML = "<p style='color:white;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            reportArea.innerHTML =
                `<h5 style="color:#1EBC3A;">Report for ${date} at ${hour}</h5>
                 <div class="border p-3 bg-white" style="white-space: pre-wrap; color:black;">
                    ${data.report_html}
                 </div>`;
        } else {
            reportArea.innerHTML =
                `<p style='color:red;'>${data.error}</p>`;
        }
    })
    .catch(error => {
        console.error("Error:", error);
        reportArea.innerHTML =
            "<p style='color:red;'>Error loading report.</p>";
    });
}

</script>

</body>
</html>




@app.route("/load-report", methods=["POST"])
def load_report():
    try:
        data = request.get_json()
        print("\nRECEIVED JSON:", data)

        env = data.get("environment")
        date = data.get("selected_date")
        hour = data.get("selected_time")

        print("ENV:", env)
        print("DATE:", date)
        print("HOUR:", hour)

        report = generate_report(env, date, hour)

        return jsonify({
            "success": True,
            "report_html": report
        })

    except Exception as e:
        print("\nERROR IN /load-report")
        print(str(e))
        return jsonify({
            "success": False,
            "error": str(e)
        }), 500





def generate_report(env, date, hour):
    try:
        session = get_db_session()

        # Select table by environment
        if env == "prd":
            result = session.query(SodPRD).filter_by(
                uploaddate=date,
                uploadhour=hour
            ).first()
        else:
            result = session.query(SodSTG).filter_by(
                uploaddate=date,
                uploadhour=hour
            ).first()

        if result:
            return result.report   # <-- your actual column name
        else:
            return "No report found for this date and hour."

    except Exception as e:
        return f"Error loading report: {str(e)}"




<script>
function loadReport(event) {
    event.preventDefault();

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;
    const reportArea = document.getElementById("report-area");

    reportArea.innerHTML = "<p style='color:white;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            reportArea.innerHTML = `
                <h5 style="color:#1EBC3A;">Report for ${date} at ${hour}</h5>
                <div class="border p-3 bg-white" style="white-space: pre-wrap;">
                    ${data.report_html}
                </div>
            `;
        } else {
            reportArea.innerHTML = `<p style='color:red;'>${data.error}</p>`;
        }
    })
    .catch(error => {
        console.error("Error:", error);
        reportArea.innerHTML = "<p style='color:red;'>Error loading report.</p>";
    });
}
</script>    


@app.route("/load-report", methods=["POST"])
def load_report():
    try:
        data = request.get_json()
        print("\nRECEIVED JSON:", data)

        env = data.get("environment")
        date = data.get("selected_date")
        hour = data.get("selected_time")

        print("ENV:", env)
        print("DATE:", date)
        print("HOUR:", hour)

        # Make sure this function exists in your code
        report = generate_report(env, date, hour)

        return jsonify({
            "success": True,
            "report_html": report
        })

    except Exception as e:
        print("\nERROR IN /load-report")
        print(str(e))
        return jsonify({
            "success": False,
            "error": str(e)
        }), 500


if __name__ == "__main__":
    app.run(debug=True)




<script>

function loadReport(event) {
    event.preventDefault();

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;

    const reportArea = document.getElementById("report-area");
    reportArea.innerHTML = "<p style='color:white;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(response => {
        return response.json();
    })
    .then(data => {
        if (data.success) {
            reportArea.innerHTML = `
                <h5 style="color:#1EBC3A;">Report for ${date} at ${hour}</h5>
                <div class="border p-3 bg-white" style="white-space: pre-wrap;">
                    ${data.report_html}
                </div>
            `;
        } else {
            reportArea.innerHTML = `<p style='color:red;'>${data.error}</p>`;
        }
    })
    .catch(error => {
        console.error("Error:", error);
        reportArea.innerHTML = "<p style='color:red;'>Error loading report.</p>";
    });
}

</script>




@app.route("/load-report", methods=["POST"])
def load_report():
    try:
        data = request.get_json()
        print("\n=== RECEIVED JSON ===")
        print(data)

        env = data.get("environment")
        date = data.get("selected_date")
        hour = data.get("selected_time")

        print("ENV:", env)
        print("DATE:", date)
        print("HOUR:", hour)

        report = generate_report(env, date, hour)

        return jsonify({"success": True, "report_html": report})

    except Exception as e:
        print("\n=== ERROR IN /load-report ===")
        print(str(e))
        return jsonify({"success": False, "error": str(e)}), 500




def generate_report(env, date, hour):
    """
    Replace this code with your actual logic to fetch report.
    """
    try:
        # Example: fetch report from your sod_prd / sod_stg tables
        if env == "prd":
            result = db.session.query(PrdModel).filter_by(uploaddate=date, uploadhour=hour).first()
        else:
            result = db.session.query(StgModel).filter_by(uploaddate=date, uploadhour=hour).first()

        if result:
            return result.report_text   # adjust to your column name
        else:
            return "No report found for this date and hour."

    except Exception as e:
        return f"Error loading report: {str(e)}"




<script>

// ---------------- LOAD REPORT AJAX (NO PAGE REFRESH) ----------------
function loadReport(event) {
    event.preventDefault();  // STOP PAGE REFRESH

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;

    const reportArea = document.getElementById("report-area");
    reportArea.innerHTML = "<p style='color:white;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            reportArea.innerHTML = `
                <h5 style="color:#1EBC3A;">Report for ${date} at ${hour}</h5>
                <div class="border p-3 bg-white" style="white-space: pre-wrap;">
                    ${data.report_html}
                </div>
            `;
        } else {
            reportArea.innerHTML = `<p style="color:red;">${data.error}</p>`;
        }
    })
    .catch(err => {
        console.error("Error:", err);
        reportArea.innerHTML = "<p style='color:red;'>Error loading report.</p>";
    });
}

</script>




@app.route("/load-report", methods=["POST"])
def load_report():
    try:
        data = request.get_json()
        print("Received data:", data)

        env = data.get("environment")
        date = data.get("selected_date")
        hour = data.get("selected_time")    # ‚úÖ FIXED KEY

        if not (env and date and hour):
            return jsonify({
                "success": False,
                "error": "Environment, date or hour missing."
            }), 400

        # Your function to generate the report
        report = generate_report(env, date, hour)

        return jsonify({
            "success": True,
            "report_html": report
        })

    except Exception as e:
        print("ERROR:", e)
        return jsonify({
            "success": False,
            "error": str(e)
        }), 500




<div style="background: #121212; padding: 20px; margin-top:70px; margin-left:100px; margin-right:100px">

    <h2 style="color: #1E9C3A; margin-bottom: 20px;">SOD Checks</h2>

    <!-- REMOVE FORM REFRESH -->
    <form id="sodForm" onsubmit="loadReport(event)">
        
        <div class="row g-3 align-items-end">

            <div class="col-md-3">

                <!-- ENVIRONMENT -->
                <label class="fw-bold">Select Environment:</label>
                <select id="environment" name="environment" onchange="fetchHours()" class="form-control mb-3" required>
                    <option value="">-- Select Environment --</option>
                    <option value="prd">PRD</option>
                    <option value="stg">STG</option>
                </select>

                <!-- DATE -->
                <label class="fw-bold">Select Date:</label>
                <input type="date" id="selected_date" name="selected_date" onchange="fetchHours()" class="form-control mb-3" required>

                <!-- HOUR -->
                <label class="fw-bold">Select Hour:</label>
                <select id="selected_time" name="selected_time" class="form-control mb-3" required>
                    <option value="">-- Select Hour --</option>
                </select>

            </div>

        </div>

        <!-- LOAD BUTTON -->
        <button type="submit"
            style="display: block; width: 100%; background: #1EBC3A; color: white; padding: 10px; border:none; font-size:16px; margin-top:10px;">
            Load Data
        </button>

    </form>

    <!-- DYNAMIC REPORT AREA -->
    <div id="report-area" class="mt-4" style="color:white;">
        <p class="text-muted">No report loaded.</p>
    </div>
</div>


<script>

// ---------------- FETCH HOURS (NO REFRESH) ----------------
function fetchHours() {

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;

    const hourDropdown = document.getElementById("selected_time");
    hourDropdown.innerHTML = "<option>Loading...</option>";

    if (!env || !date) {
        hourDropdown.innerHTML = "<option>-- Select Hour --</option>";
        return;
    }

    fetch("/get-hours", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ env: env, date: date })
    })
    .then(res => res.json())
    .then(data => {
        hourDropdown.innerHTML = "";
        
        if (!data || data.length === 0) {
            hourDropdown.innerHTML = "<option>No hours available</option>";
            return;
        }

        data.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = h;
            hourDropdown.appendChild(opt);
        });
    })
    .catch(err => {
        console.error("Error:", err);
        hourDropdown.innerHTML = "<option>Error loading hours</option>";
    });
}



// ---------------- LOAD REPORT AJAX (NO REFRESH) ----------------
function loadReport(event) {
    event.preventDefault();  // STOP PAGE REFRESH

    const env = document.getElementById("environment").value;
    const date = document.getElementById("selected_date").value;
    const hour = document.getElementById("selected_time").value;

    const reportArea = document.getElementById("report-area");
    reportArea.innerHTML = "<p style='color:white;'>Loading report...</p>";

    fetch("/load-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            environment: env,
            selected_date: date,
            selected_time: hour
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            reportArea.innerHTML = `
                <h5 style="color:#1EBC3A;">Report for ${date} at ${hour}</h5>
                <div class="border p-3 bg-white" style="white-space: pre-wrap;">
                    ${data.report_html}
                </div>
            `;
        } else {
            reportArea.innerHTML = `<p style="color:red;">${data.error}</p>`;
        }
    })
    .catch(err => {
        console.error("Error:", err);
        reportArea.innerHTML = "<p style='color:red;'>Error loading report.</p>";
    });
}

</script>






<input type="date" id="selected_date">
<select id="selected_time"></select>
<button id="loadDataBtn">Load Data</button>

<div id="reportContainer"></div>

<script>
document.getElementById("loadDataBtn").addEventListener("click", function(event) {
    event.preventDefault();  // prevent page refresh

    const selectedDate = document.getElementById("selected_date").value;
    const selectedHour = document.getElementById("selected_time").value;

    const formData = new FormData();
    formData.append("selected_date", selectedDate);
    formData.append("selected_time", selectedHour);

    fetch("/get-report", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        // Update available hours dropdown
        const hourDropdown = document.getElementById("selected_time");
        hourDropdown.innerHTML = ""; // clear existing options
        data.available_times.forEach(hour => {
            const option = document.createElement("option");
            option.value = hour;
            option.textContent = hour;
            hourDropdown.appendChild(option);
        });

        // Show report
        const reportContainer = document.getElementById("reportContainer");
        reportContainer.innerHTML = data.report_html || "<p>No report found for selected date/hour</p>";
    })
    .catch(err => console.error(err));
});
</script>





from flask import Flask, request, jsonify
import datetime

app = Flask(__name__)

@app.route("/get-report", methods=["POST"])
def get_report():
    today = datetime.date.today().strftime("%Y-%m-%d")
    raw_date = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")

    selected_date_obj = convert_date_format(raw_date)  # your date conversion function
    available_times = []
    report_html = None

    if Model and selected_date_obj:
        # Fetch all hours for the selected date
        rows = (
            session.query(Model.uploadhour)
            .filter(Model.uploaddate == selected_date_obj)
            .order_by(Model.uploadhour)
            .all()
        )
        available_times = [str(r[0]).zfill(2) for r in rows]

        if selected_hour:
            try:
                sh_int = int(selected_hour)
                row = (
                    session.query(Model)
                    .filter(
                        Model.uploaddate == selected_date_obj,
                        Model.uploadhour == sh_int
                    )
                    .first()
                )
                if row:
                    report_html = row.report
            except Exception as e:
                print("Error fetching report:", e)

    # Return JSON instead of rendering template
    return jsonify({
        "available_times": available_times,
        "report_html": report_html
    })






window.onload = function () {

    const Form = document.getElementById("Form");
    const report = document.getElementById("report-area");

    Form.onsubmit = function (event) {
        event.preventDefault();  // stop refresh

        const environment = document.getElementById("environment").value;
        const selected_date = document.getElementById("selected_date").value;
        const selected_time = document.getElementById("selected_time").value;

        // Build the URL with parameters
        const url = `/report?environment=${environment}&date=${selected_date}&hour=${selected_time}`;

        fetch(url)
            .then(response => response.text())
            .then(html => {
                report.innerHTML = html;
            })
            .catch(err => {
                report.innerHTML = "<p style='color:red;'>Error loading report</p>";
                console.error("Error:", err);
            });
    };

};




<form id="reportForm" autocomplete="off">

    <!-- Environment -->
    <label class="fw-bold">Select Environment:</label>
    <select id="environment" name="environment" class="form-control mb-3" required>
        <option value="prd" selected>PRD</option>
        <option value="stg">STG</option>
    </select>

    <!-- Select Date -->
    <label class="fw-bold">Select Date:</label>
    <input type="date" id="selected_date" name="selected_date" class="form-control mb-3">

    <!-- LOAD DATA BUTTON INSIDE FORM -->
    <button type="submit"
        style="width: 20%; background:#1EBC3A; color:white; padding:10px; border:none; font-size:16px;">
        Load Data
    </button>

</form>

<!-- REPORT -->
<div id="report_html"></div>

<script>
document.getElementById("reportForm").addEventListener("submit", function(event) {
    event.preventDefault();   // üî• STOP PAGE REFRESHING COMPLETELY

    let env = document.getElementById("environment").value;
    let date = document.getElementById("selected_date").value;

    document.getElementById("report_html").innerHTML = "Loading...";

    fetch(`/get_report?env=${env}&date=${date}`)
        .then(res => res.text())
        .then(data => {
            document.getElementById("report_html").innerHTML = data;
        })
        .catch(err => {
            document.getElementById("report_html").innerHTML = "Error loading report";
        });
});
</script>





<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DevOps Portal Layout</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .main-container {
      margin: 40px auto;
      max-width: 1200px;
    }
    .big-box {
      background: #fff;
      border: 2px solid #dee2e6;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .small-box {
      background-color: #f1f5f9;
      border-radius: 10px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .small-box:hover {
      background-color: #e2e8f0;
      transform: translateY(-3px);
    }
    .small-box h5 {
      font-size: 18px;
      margin-top: 10px;
      font-weight: 600;
    }
  </style>
</head>
<body>

<div class="container main-container">
  <h2 class="text-center mb-4 fw-bold">Welcome to the DevOps Portal</h2>
  <p class="text-center mb-5">Explore tools to enhance your DevOps journey.</p>

  <!-- Row 1 -->
  <div class="row g-4">
    <!-- Left Big Box -->
    <div class="col-md-6">
      <div class="big-box">
        <div class="row g-3">
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=20415&format=png" alt="">
              <h5>DevOps Docs</h5>
            </div>
          </div>
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=23215&format=png" alt="">
              <h5>Pipeline Product</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Big Box -->
    <div class="col-md-6">
      <div class="big-box">
        <div class="row g-3">
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=80363&format=png" alt="">
              <h5>Developer VM</h5>
            </div>
          </div>
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=103132&format=png" alt="">
              <h5>Argo Workflow</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Row 2 -->
  <div class="row g-4 mt-3">
    <div class="col-md-6">
      <div class="big-box">
        <div class="row g-3">
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=13793&format=png" alt="">
              <h5>Code Restore</h5>
            </div>
          </div>
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=23236&format=png" alt="">
              <h5>API Key</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="big-box">
        <div class="row g-3">
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=149&format=png" alt="">
              <h5>Performance Centre</h5>
            </div>
          </div>
          <div class="col-6">
            <div class="small-box">
              <img src="https://img.icons8.com/?size=48&id=59946&format=png" alt="">
              <h5>Contact DevOps</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>








<script>
function loadData() {
    // Get selected values
    let environment = document.getElementById("environment").value;
    let date = document.getElementById("selected_date").value;

    // Optional: clear previous report
    document.getElementById("report_html").innerHTML = "Loading...";

    // Fetch data from server without refreshing the page
    fetch(`/get_report?env=${environment}&date=${date}`)
        .then(response => response.text()) // or .json() if your server returns JSON
        .then(data => {
            document.getElementById("report_html").innerHTML = data;
        })
        .catch(error => {
            console.error("Error fetching report:", error);
            document.getElementById("report_html").innerHTML = "Error loading data.";
        });
}
</script>



<script>
window.onload = function() {
    // Reset environment dropdown
    let env = document.getElementById("environment");
    if(env) env.value = "";

    // Set today's date
    let today = new Date().toISOString().split("T")[0];
    let dateInput = document.getElementById("selected_date");
    if(dateInput) dateInput.value = today;

    // Clear hours dropdown
    let hours = document.getElementById("selected_time");
    if(hours) hours.innerHTML = "<option>No time available</option>";

    // Clear report
    let reportDiv = document.getElementById("report_html");
    if(reportDiv) reportDiv.innerHTML = "";
};
</script> 


function resetForm() {
    // Reset environment dropdown
    document.getElementById("environment").value = "";

    // Set today's date
    let today = new Date().toISOString().split("T")[0];
    document.getElementById("selected_date").value = today;

    // Clear hours dropdown
    document.getElementById("selected_time").innerHTML =
        "<option>No time available</option>";

    // Clear report
    let reportDiv = document.getElementById("report_html");
    if (reportDiv) {
        reportDiv.innerHTML = ""; // remove old report
    }

    // Optional: disable "Load Report" button until new selections
    // document.getElementById("load_button").disabled = true;
}



<script>
function resetForm() {
    // Reset environment
    document.getElementById("environment").value = "";

    // Set today's date
    let today = new Date().toISOString().split("T")[0];
    document.getElementById("selected_date").value = today;

    // Clear hours dropdown
    document.getElementById("selected_time").innerHTML =
        "<option>No time available</option>";

    // Clear report
    document.getElementById("report_html").innerHTML = "";
}
</script>



<script>
function resetForm() {
    document.getElementById("environment").value = "";
    document.getElementById("selected_date").value = "";
    document.getElementById("selected_time").innerHTML = "<option>No time available</option>";
    document.getElementById("report_html").innerHTML = "";
}
</script>


<script>
function fetchHours() {

    const env = document.getElementById("environment").value.trim().toLowerCase();
    const date = document.getElementById("selected_date").value;

    // Clear dropdown first
    const hourDropdown = document.getElementById("selected_time");
    hourDropdown.innerHTML = "<option>Loading...</option>";

    if (!env || !date) {
        hourDropdown.innerHTML = "<option>No time available</option>";
        return;
    }

    fetch("/get-hours", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            env: env,
            date: date
        })
    })
    .then(response => response.json())
    .then(data => {
        hourDropdown.innerHTML = "";

        if (!Array.isArray(data) || data.length === 0) {
            hourDropdown.innerHTML = "<option>No time available</option>";
            return;
        }

        data.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = h;
            hourDropdown.appendChild(opt);
        });
    })
    .catch(err => {
        console.error("Error fetching hours:", err);
        hourDropdown.innerHTML = "<option>Error loading hours</option>";
    });
}
</script>




@app.route("/get-hours", methods=["POST"])
def get_hours_api():
    data = request.get_json() or {}

    env = data.get("env")      # "prd" or "stg"
    raw_date = data.get("date")

    if not env or not raw_date:
        return jsonify([])

    # Convert date (supports yyyy-mm-dd or mm-dd-yyyy)
    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify([])

    # Pick model
    if env.lower() == "prd":
        Model = SodPRD
    elif env.lower() == "stg":
        Model = SodSTG
    else:
        return jsonify([])

    session = get_db_session()

    try:
        rows = (
            session.query(Model.uploadhour)
            .filter(Model.uploaddate == selected_date_obj)
            .order_by(Model.uploadhour)
            .all()
        )

        hours = [str(r[0]).zfill(2) for r in rows]
        return jsonify(hours)

    except Exception as e:
        print("ERROR loading hours:", e)
        return jsonify([])




@app.route("/get-hours")
def get_hours_api():
    env = request.args.get("env")
    date_str = request.args.get("date")

    if not env or not date_str:
        return jsonify({"error": "Missing parameters"})

    try:
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
    except:
        return jsonify({"error": "Invalid date format"})

    table = "sod_" + env.lower()      # auto pick sod_prd or sod_stg

    result = get_hours(env, table, dt, dt)

    return jsonify(result)




function loadHours() {
    const env = document.getElementById("env").value;
    const date = document.getElementById("date").value;

    if (!date) return;

    fetch(`/get-hours?env=${env}&date=${date}`)
        .then(res => res.json())
        .then(data => {
            const hourSelect = document.getElementById("hour");
            hourSelect.innerHTML = "";

            if (data.error || !data.data || data.data.length === 0) {
                hourSelect.innerHTML = `<option>Error loading hours</option>`;
                return;
            }

            data.data.forEach(row => {
                hourSelect.innerHTML += `<option>${row.run_hour}</option>`;
            });
        })
        .catch(err => {
            document.getElementById("hour").innerHTML =
                `<option>Error loading hours</option>`;
        });
}



<script>
$(document).ready(function () {

    $("#selected_date").on("change", function () {
        let dateval = $(this).val();
        let env = $("#environment").val();
        let dropdown = $("#selected_time");

        if (!dateval || !env) {
            dropdown.empty();
            dropdown.append('<option value="">Select environment & date</option>');
            return;
        }

        $.ajax({
            url: "/get_hours",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                env: env,
                date: dateval
            }),
            success: function (hours) {
                dropdown.empty();

                if (!hours || hours.length === 0) {
                    dropdown.append('<option value="">No time available</option>');
                    return;
                }

                hours.forEach(function (h) {
                    dropdown.append(`<option value="${h}">${h}</option>`);
                });
            },
            error: function (err) {
                console.error("Error fetching hours:", err);
                dropdown.empty();
                dropdown.append('<option value="">Error loading hours</option>');
            }
        });

    });

});
</script>

<!-- Environment -->
<label class="fw-bold">Environment</label>
<select id="environment" name="environment" class="form-control mb-3" required>
    <option value="">-- Select Environment --</option>
    <option value="prd" {% if environment == 'prd' %}selected{% endif %}>PRD</option>
    <option value="stg" {% if environment == 'stg' %}selected{% endif %}>STG</option>
</select>

<!-- Select Date -->
<label class="fw-bold">Select Date:</label>
<input type="date" id="selected_date" name="selected_date"
       class="form-control mb-3" required value="{{ selected_date }}">

<!-- Select Hour -->
<label class="fw-bold">Select Hour:</label>
<select id="selected_time" name="selected_time" class="form-control mb-3" required>
    {% if available_times %}
        {% for t in available_times %}
            <option value="{{ t }}" {% if selected_hour == t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
    {% else %}
        <option value="">No time available</option>
    {% endif %}
</select>


@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():

    session = get_db_session()

    today = datetime.date.today().strftime("%Y-%m-%d")
    raw_date = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")
    environment = request.form.get("environment", "Prd")   # Prd / Stg

    # ---- Convert incoming date ----
    selected_date_obj = convert_date_format(raw_date)
    available_times = []

    # ---- Select model based on environment ----
    if environment.lower() == "prd":
        sod_model = sodPrd
    else:
        sod_model = sodStg
    # -------------------------------------------

    # ---- Fetch available hours for selected date ----
    if selected_date_obj:
        rows = (
            session.query(sod_model.uploadhour)
            .filter(sod_model.uploaddate == selected_date_obj)
            .order_by(sod_model.uploadhour)
            .all()
        )

        available_times = [str(r[0]).zfill(2) for r in rows]

    # ---- Fetch report for selected hour ----
    report_html = None

    if selected_hour:
        try:
            sh_int = int(selected_hour)
            row = (
                session.query(sod_model)
                .filter(
                    sod_model.uploaddate == selected_date_obj,
                    sod_model.uploadhour == sh_int
                )
                .first()
            )
            if row:
                report_html = row.report

        except Exception as e:
            print("Error fetching report:", e)

    return render_template(
        "sod.html",
        environment=environment,
        selected_date=raw_date,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )



<!-- templates/sod.html -->
{% extends "base.html" %}
{% block content %}
<div class="card p-4">
  <form method="post" id="sodForm">
    <div class="row g-3 align-items-end">
      <div class="col-md-3">
        <label for="environment" class="form-label">Environment</label>
        <select class="form-select" id="environment" name="environment" onchange="fetchHoursAndSubmit(false)">
          <option value="PRD" {% if environment == 'PRD' %}selected{% endif %}>PRD</option>
          <option value="STG" {% if environment == 'STG' %}selected{% endif %}>STG</option>
        </select>
      </div>

      <div class="col-md-3">
        <label for="selected_date" class="form-label">Date</label>
        <input type="date" id="selected_date" name="selected_date" class="form-control"
               value="{{ selected_date or '' }}" onchange="fetchHoursAndSubmit(false)">
      </div>

      <div class="col-md-3">
        <label for="selected_time" class="form-label">Hour</label>
        <select id="selected_time" name="selected_time" class="form-select" onchange="submitForm()">
          <option value="">Select HRS</option>
          {% for h in available_times %}
            <option value="{{ h }}" {% if selected_hour == h %}selected{% endif %}>{{ h }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <button type="submit" class="btn btn-success">Show Report</button>
        <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset</button>
      </div>
    </div>
  </form>

  <hr class="my-4">

  <div id="report-area">
    {% if report_html %}
      <h5>Report for {{ selected_date }} - {{ selected_hour }}</h5>
      <div class="border p-3 bg-white" style="white-space: pre-wrap;">
        {{ report_html | safe }}
      </div>
    {% else %}
      <p class="text-muted">No report selected or no report available for that date/hour.</p>
    {% endif %}
  </div>
</div>

<script>
async function fetchHoursAndSubmit(submitAfter=true) {
  const env = document.getElementById('environment').value;
  const date = document.getElementById('selected_date').value;

  // basic validation
  if (!date) {
    document.getElementById('selected_time').innerHTML = '<option value="">Select HRS</option>';
    if (submitAfter) document.getElementById('sodForm').submit();
    return;
  }

  try {
    const resp = await fetch('/get_hours', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ date: date, environment: env })
    });
    const hours = await resp.json();
    const sel = document.getElementById('selected_time');
    sel.innerHTML = '<option value="">Select HRS</option>';
    hours.forEach(h => {
      const opt = document.createElement('option');
      opt.value = h;
      opt.text = h;
      sel.appendChild(opt);
    });
    // keep previously selected hour if still present
    {% if selected_hour %}
    const prev = "{{ selected_hour }}";
    if (prev) {
      const opt = Array.from(sel.options).find(o => o.value === prev);
      if (opt) opt.selected = true;
    }
    {% endif %}

    if (submitAfter) {
      document.getElementById('sodForm').submit();
    }
  } catch (err) {
    console.error("Error fetching hours:", err);
  }
}

function submitForm(){
  document.getElementById('sodForm').submit();
}

function resetForm(){
  document.getElementById('environment').value = 'PRD';
  document.getElementById('selected_date').value = '';
  document.getElementById('selected_time').innerHTML = '<option value="">Select HRS</option>';
}
</script>
{% endblock %}






# app.py
from flask import Flask, render_template, request, jsonify
import datetime
from controller import get_db_session, convert_date_format, SodPrd, SodStg, create_tables

app = Flask(__name__)

# optionally create tables if you want (comment out in production)
create_tables()

# map env to model
ENV_MODEL_MAP = {
    "PRD": SodPrd,
    "STG": SodStg
}

@app.route("/")
def home():
    return render_template("base.html")

@app.route("/sod-checks", methods=["GET", "POST"])
def sod_checks():
    session = get_db_session()
    # default date string format yyyy-mm-dd
    today_str = datetime.date.today().strftime("%Y-%m-%d")
    raw_date = request.form.get("selected_date", today_str)
    selected_hour = request.form.get("selected_time", "")
    environment = request.form.get("environment", "PRD").upper()

    selected_date_obj = convert_date_format(raw_date)
    available_times = []
    report_html = None

    model = ENV_MODEL_MAP.get(environment, SodPrd)

    if selected_date_obj:
        try:
            rows = session.query(model.uploadhour).filter(
                model.uploaddate == selected_date_obj
            ).order_by(model.uploadhour).all()
            # rows is list of tuples like [(1,), (2,), ...]
            available_times = [str(r[0]).zfill(2) for r in rows]
        except Exception as e:
            print("Error querying hours:", e)

    if selected_hour and selected_date_obj:
        try:
            hour_int = int(selected_hour)
            row = session.query(model).filter(
                model.uploaddate == selected_date_obj,
                model.uploadhour == hour_int
            ).first()
            if row:
                report_html = row.report
        except Exception as e:
            print("Error fetching report:", e)

    return render_template(
        "sod.html",
        environment=environment,
        selected_date=raw_date,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )

@app.route("/get_hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}
    raw_date = data.get("date")
    environment = (data.get("environment") or "PRD").upper()

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify([])

    session = get_db_session()
    model = ENV_MODEL_MAP.get(environment, SodPrd)
    try:
        rows = session.query(model.uploadhour).filter(
            model.uploaddate == selected_date_obj
        ).order_by(model.uploadhour).all()
        hours = [str(r[0]).zfill(2) for r in rows]
    except Exception as e:
        print("Error in get_hours:", e)
        hours = []
    return jsonify(hours)

if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0")





# controller.py
import os
import datetime
from sqlalchemy import create_engine, Column, Integer, Date, Text, MetaData
from sqlalchemy.orm import declarative_base, sessionmaker, scoped_session

# set this env var or replace with a string
DATABASE_URL = os.environ.get("DATABASE_URL", "postgresql://username:password@host:5432/database")

# Engine and session
engine = create_engine(DATABASE_URL, pool_pre_ping=True)
SessionLocal = scoped_session(sessionmaker(autocommit=False, autoflush=True, bind=engine))

# base
Base = declarative_base()

# Example schema name if needed; set to None or 'public' if you don't use schema
DEFAULT_SCHEMA = None  # or 'nod' if you want schema named 'nod'

def get_table_kwargs():
    if DEFAULT_SCHEMA:
        return {"schema": DEFAULT_SCHEMA}
    return {}

# Two table models: sod_prd and sod_stg
class SodPrd(Base):
    __tablename__ = "sod_prd"
    __table_args__ = (get_table_kwargs(),)

    uploaddate = Column(Date, primary_key=True, nullable=False)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"<SodPrd {self.uploaddate} {self.uploadhour}>"

class SodStg(Base):
    __tablename__ = "sod_stg"
    __table_args__ = (get_table_kwargs(),)

    uploaddate = Column(Date, primary_key=True, nullable=False)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"<SodStg {self.uploaddate} {self.uploadhour}>"

# Create tables if they don't exist (optional)
def create_tables():
    try:
        Base.metadata.create_all(bind=engine)
    except Exception as e:
        print("Warning creating tables:", e)

# Helper to get DB session
def get_db_session():
    return SessionLocal()

# Date parsing helper: accept yyyy-mm-dd or mm-dd-yyyy (and also ones with slashes)
def convert_date_format(date_str: str):
    if not date_str:
        return None
    date_str = date_str.strip()
    formats = ["%Y-%m-%d", "%m-%d-%Y", "%m/%d/%Y", "%Y/%m/%d"]
    for fmt in formats:
        try:
            dt = datetime.datetime.strptime(date_str, fmt).date()
            return dt
        except Exception:
            continue
    # try some common alternate ordering (dd-mm-yyyy)
    alt_formats = ["%d-%m-%Y", "%d/%m/%Y"]
    for fmt in alt_formats:
        try:
            dt = datetime.datetime.strptime(date_str, fmt).date()
            return dt
        except Exception:
            continue
    return None





from flask import Flask, request, jsonify

app = Flask(__name__)

# Make sure SOD_PRD, SOD_STG, convert_date_format, and get_session_and_model are imported

@app.route("/generate-report", methods=["POST"])
def generate_report():
    data = request.get_json() or {}
    environment = data.get("environment", "prd").lower()
    raw_date = data.get("date")
    hour = data.get("hour")

    # Convert date
    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"report": "Invalid date"})

    # Get session and model based on environment
    session, table = get_session_and_model(environment)

    try:
        # Fetch the row for selected date and hour
        row = session.query(table).filter(
            table.uploaddate == selected_date_obj,
            table.uploadhour == int(hour)
        ).first()

        if not row:
            report_text = "No report found"
        else:
            report_text = row.report

    except Exception as e:
        print("Error generating report:", e)
        report_text = "Error fetching report"
    finally:
        session.close()

    return jsonify({"report": report_text})




from flask import Flask, request, jsonify
from sqlalchemy import create_engine, Column, Integer, Date, Text
from sqlalchemy.orm import declarative_base, sessionmaker
import datetime

app = Flask(__name__)
Base = declarative_base()

# --- Database URLs ---
PRD_DATABASE_URL = "postgresql://username:password@prd_host:port/prd_database"
STG_DATABASE_URL = "postgresql://username:password@stg_host:port/stg_database"  # separate if needed

# --- Engines & Sessions ---
PRD_ENGINE = create_engine(PRD_DATABASE_URL, pool_pre_ping=True)
STG_ENGINE = create_engine(STG_DATABASE_URL, pool_pre_ping=True)

PRD_SessionLocal = sessionmaker(bind=PRD_ENGINE, autoflush=True)
STG_SessionLocal = sessionmaker(bind=STG_ENGINE, autoflush=True)

# --- Models ---
class SOD_PRD(Base):
    __tablename__ = "sod_prd"
    __table_args__ = {"schema": "sod"}  # replace with your actual PRD schema

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

class SOD_STG(Base):
    __tablename__ = "sod_stg"
    __table_args__ = {"schema": "sod"}  # replace with your actual STG schema

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

# --- Utility ---
def convert_date_format(raw_date):
    try:
        for fmt in ("%Y-%m-%d", "%m-%d-%Y"):
            try:
                return datetime.datetime.strptime(raw_date, fmt).date()
            except:
                continue
        return None
    except:
        return None

def get_session_and_model(environment):
    if environment.lower() == "prd":
        return PRD_SessionLocal(), SOD_PRD
    else:
        return STG_SessionLocal(), SOD_STG

# --- Route ---
@app.route("/get-hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}
    raw_date = data.get("date")
    environment = data.get("environment", "prd")

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"hours": []})

    session, model = get_session_and_model(environment)

    try:
        hours = session.query(model.uploadhour).filter(model.uploaddate == selected_date_obj).all()
        return jsonify({"hours": [h[0] for h in hours]})
    except Exception as e:
        print("Error fetching hours:", e)
        return jsonify({"hours": []})
    finally:
        session.close()

if __name__ == "__main__":
    app.run(debug=True)




# API used by frontend to populate hours dynamically
@app.route("/get-hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}

    raw_date = data.get("date")
    environment = data.get("environment", "prd").strip().lower()

    print("Environment received:", environment)

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"hours": []})

    # -------- Correct table selection --------
    if environment in ["prd", "pro"]:
        table = SOD_PRD
    elif environment == "stg":
        table = SOD_STG
    else:
        print("Invalid environment:", environment)
        return jsonify({"hours": []})
    # -----------------------------------------

    session = get_db_session()
    try:
        rows = (
            session.query(table.uploadhour)
            .filter(table.uploaddate == selected_date_obj)
            .order_by(table.uploadhour)
            .all()
        )

        hours = [str(r[0]).zfill(2) for r in rows]

    except Exception as e:
        print("Error in get_hours:", e)
        hours = []

    finally:
        session.close()

    return jsonify({"hours": hours})


# API: generate report (called by frontend)
@app.route("/generate-report", methods=["POST"])
def generate_report():
    data = request.get_json() or {}

    environment = data.get("environment", "prd").strip().lower()
    raw_date = data.get("date")
    hour = data.get("hour")

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"report": "Invalid date"})

    # -------- Correct table selection --------
    if environment in ["prd", "pro"]:
        table = SOD_PRD
    elif environment == "stg":
        table = SOD_STG
    else:
        print("Invalid environment:", environment)
        return jsonify({"report": "Invalid environment"})
    # -----------------------------------------

    session = get_db_session()
    try:
        row = (
            session.query(table)
            .filter(
                table.uploaddate == selected_date_obj,
                table.uploadhour == int(hour)
            )
            .first()
        )

        if not row:
            report = "No report found"
        else:
            report = row.report

    except Exception as e:
        print("Error generating report:", e)
        report = "Error fetching report"

    finally:
        session.close()

    return jsonify({"report": report})


if __name__ == "__main__":
    app.run(debug=True)





@app.route("/get-hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}

    raw_date = data.get("date")
    environment = data.get("environment", "prd").strip().lower()

    print("ENV RECEIVED:", environment)

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"hours": []})

    # ‚Üê‚Üê MOST IMPORTANT FIX
    if environment == "prd" or environment == "pro":
        table = sod_prd
    elif environment == "stg":
        table = sod_stg
    else:
        print("Invalid environment:", environment)
        return jsonify({"hours": []})

    session = get_db_session()
    try:
        rows = (
            session.query(table.uploadhour)
            .filter(table.uploaddate == selected_date_obj)
            .order_by(table.uploadhour)
            .all()
        )

        hours = [str(r[0]).zfill(2) for r in rows]

    except Exception as e:
        print("Error in get-hours:", e)
        hours = []

    finally:
        session.close()

    return jsonify({"hours": hours})





<script>
$(document).ready(function () {

    // When user changes PRD/STG environment
    $("#environment").change(function () {
        let env = $(this).val().toLowerCase();
        console.log("Selected environment:", env);

        // Clear hours dropdown
        $("#selected_time").empty();
        $("#selected_time").append(`<option value="">Select Time</option>`);

        // Trigger date change again to load new hours of that environment
        $("#selected_date").trigger("change");
    });

    // Load hours automatically when date changes
    $("#selected_date").change(function () {
        let selectedDate = $(this).val();
        let env = $("#environment").val().toLowerCase();

        console.log("Fetching hours for:", env);

        $.ajax({
            url: "/get-hours",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                date: selectedDate,
                environment: env
            }),
            success: function (response) {
                $("#selected_time").empty();
                $("#selected_time").append(`<option value="">Select Time</option>`);

                response.hours.forEach(hr => {
                    $("#selected_time").append(`<option value="${hr}">${hr}</option>`);
                });
            },
            error: function () {
                alert("Error loading hours");
            }
        });
    });

});
</script>





# controller.py
import datetime
import os

import psycopg2
from sqlalchemy import (
    create_engine,
    Column,
    Integer,
    Text,
    Date,
    inspect,
)
from sqlalchemy.schema import CreateSchema
from sqlalchemy.orm import declarative_base, sessionmaker

# ------------------------------
# CONFIG - set environment variables or replace with actual values
# ------------------------------
DB_USER = os.getenv("DB_USER", "username")
DB_PASS = os.getenv("DB_PASS", "password")
DB_HOST = os.getenv("DB_HOST", "localhost")
DB_PORT = os.getenv("DB_PORT", "5432")
DB_NAME = os.getenv("DB_NAME", "database")
SCHEMA_NAME = os.getenv("DB_SCHEMA", "sod")

DATABASE_URL = f"postgresql://{DB_USER}:{DB_PASS}@{DB_HOST}:{DB_PORT}/{DB_NAME}"

# ------------------------------
# ENGINE / SESSION
# ------------------------------
engine = create_engine(DATABASE_URL, pool_pre_ping=True)
SessionLocal = sessionmaker(autoflush=True, bind=engine)
Base = declarative_base()

# Make sure schema exists (Postgres)
try:
    with engine.connect() as connection:
        inspector = inspect(engine)
        # Create schema only if it doesn't exist
        if SCHEMA_NAME not in inspector.get_schema_names():
            connection.execute(CreateSchema(SCHEMA_NAME))
except Exception as e:
    print("Create schema warning:", e)

# ------------------------------
# Optional: simple psycopg2 connection helper
# ------------------------------
def getConnection(host, port, database, username, password):
    """
    Returns a raw psycopg2 connection or None on failure.
    Useful for quick ad-hoc queries outside SQLAlchemy.
    """
    try:
        conn = psycopg2.connect(
            user=username,
            password=password,
            host=host,
            port=port,
            database=database,
        )
        return conn
    except Exception as e:
        print(f"Not able to connect with error: {e}")
        return None

# ------------------------------
# MODELS
# ------------------------------
class SOD_PRD(Base):
    __tablename__ = "sod_prd"
    __table_args__ = {"schema": SCHEMA_NAME}

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"<SOD_PRD {self.uploaddate} {self.uploadhour}>"


class SOD_STG(Base):
    __tablename__ = "sod_stg"
    __table_args__ = {"schema": SCHEMA_NAME}

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"<SOD_STG {self.uploaddate} {self.uploadhour}>"

# If you want SQLAlchemy to create tables if missing (optional):
def create_tables():
    Base.metadata.create_all(bind=engine)

# ------------------------------
# DB SESSION ACCESSOR
# ------------------------------
def get_db_session():
    """
    Returns a new SQLAlchemy Session instance.
    Caller should close the session when done: session.close()
    """
    return SessionLocal()








# app.py
import datetime
from flask import Flask, render_template, request, jsonify

from controller import (
    get_db_session,
    SOD_PRD,
    SOD_STG,
    create_tables,
    SCHEMA_NAME,
)

app = Flask(__name__)

# Optionally ensure tables exist (uncomment if you want SQLAlchemy to create)
# create_tables()

def convert_date_format(date_str):
    """
    Accepts yyyy-mm-dd or mm-dd-yyyy and returns a date object.
    Returns None on failure.
    """
    if not date_str:
        return None
    try:
        # try ISO yyyy-mm-dd
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
        return dt
    except Exception:
        pass

    try:
        # try mm-dd-yyyy
        dt = datetime.datetime.strptime(date_str, "%m-%d-%Y").date()
        return dt
    except Exception:
        return None


@app.route("/")
def home():
    return render_template("base.html")  # keep your existing base.html


@app.route("/ServiceNow", methods=["GET", "POST"])
def ServiceNow():
    return render_template("ServiceNow-Dashboard.html")


@app.route("/Dynatrace", methods=["GET", "POST"])
def Dynatrace():
    return render_template("Dynatrace.html")


@app.route("/sod-checks", methods=["GET", "POST"])
def sod_checks():
    """
    Renders SOD.html (or SOD template) and processes form submissions.
    Form fields expected:
      - environment: "prd" or "stg"
      - selected_date: yyyy-mm-dd (HTML date input)
      - selected_time: hour value (e.g. "01" or 1)
    """
    session = get_db_session()

    today = datetime.date.today().strftime("%Y-%m-%d")

    raw_date = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")

    selected_date_obj = convert_date_format(raw_date)

    available_times = []
    report_html = None

    # Choose table based on environment (form value or default to prd)
    environment = request.form.get("environment", "prd").lower()
    table = SOD_PRD if environment == "prd" else SOD_STG

    if selected_date_obj:
        try:
            rows = (
                session.query(table.uploadhour)
                .filter(table.uploaddate == selected_date_obj)
                .order_by(table.uploadhour)
                .all()
            )
            # keep format like "01", "02" for dropdown
            available_times = [str(r[0]).zfill(2) for r in rows]
        except Exception as e:
            print("Error fetching hours:", e)

    if selected_hour:
        try:
            sh_int = int(selected_hour)
            row = (
                session.query(table)
                .filter(table.uploaddate == selected_date_obj, table.uploadhour == sh_int)
                .first()
            )
            if row:
                report_html = row.report
        except Exception as e:
            print("Error fetching report:", e)

    session.close()

    return render_template(
        "SOD.html",
        environment=environment,
        selected_date=raw_date,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html,
    )


# API used by frontend to populate hours dynamically
@app.route("/get-hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}
    raw_date = data.get("date")
    environment = data.get("environment", "prd").lower()

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"hours": []})

    table = SOD_PRD if environment == "prd" else SOD_STG

    session = get_db_session()
    try:
        rows = (
            session.query(table.uploadhour)
            .filter(table.uploaddate == selected_date_obj)
            .order_by(table.uploadhour)
            .all()
        )
        hours = [str(r[0]).zfill(2) for r in rows]
    except Exception as e:
        print("Error in get_hours:", e)
        hours = []
    finally:
        session.close()

    return jsonify({"hours": hours})


# API: generate report (called by frontend)
@app.route("/generate-report", methods=["POST"])
def generate_report():
    data = request.get_json() or {}
    environment = data.get("environment", "prd").lower()
    raw_date = data.get("date")
    hour = data.get("hour")

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify({"report": "Invalid date"})

    table = SOD_PRD if environment == "prd" else SOD_STG

    session = get_db_session()
    try:
        row = (
            session.query(table)
            .filter(table.uploaddate == selected_date_obj, table.uploadhour == int(hour))
            .first()
        )
        if not row:
            report = "No report found"
        else:
            report = row.report
    except Exception as e:
        print("Error generating report:", e)
        report = "Error fetching report"
    finally:
        session.close()

    return jsonify({"report": report})


if __name__ == "__main__":
    app.run(debug=True)



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOD Checks</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            background: #f2f2f2;
            padding: 20px;
        }
        .card {
            margin: auto;
            width: 80%;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>

<body>

<div class="card">
    <h2>SOD Checks</h2>
    <form action="/sod-checks" method="POST">

        <!-- Environment -->
        <label><b>Select Environment</b></label>
        <select name="environment" class="form-control mb-3">
            <option value="pro" {% if environment == "pro" %}selected{% endif %}>PRD</option>
            <option value="stg" {% if environment == "stg" %}selected{% endif %}>STG</option>
        </select>

        <!-- Date -->
        <label><b>Select Date</b></label>
        <input type="date" 
               id="selected_date" 
               name="selected_date"
               value="{{ selected_date }}"
               class="form-control mb-3">

        <!-- Hours -->
        <label><b>Select Hour</b></label>
        <select name="selected_time" id="selected_time" class="form-control mb-3">
            {% if available_times %}
                {% for t in available_times %}
                    <option value="{{ t }}" {% if selected_hour == t %}selected{% endif %}>
                        {{ t }}:00
                    </option>
                {% endfor %}
            {% else %}
                <option>No time available</option>
            {% endif %}
        </select>

        <button class="btn btn-primary" style="width:100%;">Load Data</button>
    </form>

    <hr>

    <h4>Report</h4>
    <div style="white-space: pre-wrap; background:#fff; padding:15px; border-radius:8px; border:1px solid #ddd;">
        {{ final_report | safe }}
    </div>

</div>


<script>
$(document).ready(function () {

    $("#selected_date").on("change", function () {
        let dateVal = $(this).val();
        let env = $("select[name='environment']").val();

        if (!dateVal) return;

        $.ajax({
            url: "/get-hours",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                date: dateVal,
                environment: env
            }),
            success: function (resp) {

                let hoursDropdown = $("#selected_time");
                hoursDropdown.empty();

                if (resp.hours && resp.hours.length > 0) {
                    resp.hours.forEach(function (h) {
                        hoursDropdown.append(`<option value="${h}">${h}:00</option>`);
                    });
                } else {
                    hoursDropdown.append(`<option>No time available</option>`);
                }
            },
            error: function (err) {
                console.error("Error fetching hours:", err);
            }
        });

    });

});
</script>

</body>
</html>




<!DOCTYPE html>
<html>
<head>
    <title>SOD Checks</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>

<h2>SOD CHECKS</h2>

<!-- ENVIRONMENT SELECTION -->
<label>Environment:</label>
<select id="environment">
    <option value="pro">Production</option>
    <option value="stg">Staging</option>
</select>

<br><br>

<!-- DATE -->
<label>Select Date:</label>
<input type="date" id="date">

<br><br>

<!-- HOURS -->
<label>Select Hour:</label>
<select id="hour">
    <option value="">-- Select Hour --</option>
</select>

<script>
    // On Date Change ‚Üí Auto Load Hours
    $("#date, #environment").on("change", function () {

        let date = $("#date").val();
        let env = $("#environment").val();

        if (!date) return;

        $.ajax({
            url: "/get-hours",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                date: date,
                environment: env
            }),
            success: function (hours) {
                $("#hour").empty();

                if (hours.length === 0) {
                    $("#hour").append(`<option>No data</option>`);
                    return;
                }

                hours.forEach(function (h) {
                    $("#hour").append(`<option value="${h}">${h}</option>`);
                });
            }
        });
    });
</script>

</body>
</html>




from sqlalchemy import create_engine, Column, Integer, Text, Date
from sqlalchemy.orm import declarative_base, sessionmaker
from sqlalchemy.schema import CreateSchema
import datetime
import psycopg2

DATABASE_URL = "postgresql+psycopg2://username:password@host:port/dbname"

# ----------------------------------------------------------
# ENGINE
# ----------------------------------------------------------
engine = create_engine(
    DATABASE_URL,
    pool_pre_ping=True
)

# ----------------------------------------------------------
# CREATE SCHEMA IF NOT EXISTS
# ----------------------------------------------------------
schema_name = "sod"

try:
    with engine.connect() as connection:
        connection.execute(CreateSchema(schema_name, if_not_exists=True))
        print("Schema checked/created successfully.")
except Exception as e:
    print("Create schema warning:", e)

# ----------------------------------------------------------
# SESSION
# ----------------------------------------------------------
SessionLocal = sessionmaker(autoflush=True, bind=engine)
Base = declarative_base()

def get_db():
    return SessionLocal()

# ----------------------------------------------------------
# OPTIONAL DIRECT CONNECTION VIA psycopg2
# ----------------------------------------------------------
def getConnection(host, port, database, username, password):
    try:
        conn = psycopg2.connect(
            user=username,
            password=password,
            host=host,
            port=port,
            database=database
        )
        return conn
    except Exception as e:
        print(f"Not able to connect with error: {e}")
        return None

# ----------------------------------------------------------
# TABLE 1 : sod_prd
# ----------------------------------------------------------
class SodPrd(Base):
    __tablename__ = "sod_prd"
    __table_args__ = {'schema': schema_name}

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"{self.uploaddate}, {self.uploadhour}, {self.report}"


# ----------------------------------------------------------
# TABLE 2 : sod_stg
# ----------------------------------------------------------
class SodStg(Base):
    __tablename__ = "sod_stg"
    __table_args__ = {'schema': schema_name}

    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"{self.uploaddate}, {self.uploadhour}, {self.report}"


# ----------------------------------------------------------
# CREATE TABLES
# ----------------------------------------------------------
Base.metadata.create_all(engine)

print("Tables created successfully.")




@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():

    session = get_db()
    today = datetime.date.today().strftime("%Y-%m-%d")

    raw_date = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")
    selected_date_obj = convert_date_format(raw_date)

    available_times = []

    # -------------------------------------------------------
    # FETCH HOURS FROM PRD + STG BOTH
    # -------------------------------------------------------
    if selected_date_obj:
        try:
            prd_rows = (
                session.query(SodPrd.uploadhour)
                .filter(SodPrd.uploaddate == selected_date_obj)
                .all()
            )

            stg_rows = (
                session.query(SodStg.uploadhour)
                .filter(SodStg.uploaddate == selected_date_obj)
                .all()
            )

            merged = set([r[0] for r in prd_rows] + [r[0] for r in stg_rows])
            available_times = [str(h).zfill(2) for h in sorted(merged)]

        except Exception as e:
            print("Error fetching hours:", e)

    # -------------------------------------------------------
    # FETCH REPORT ‚Üí PRD PRIORITY, ELSE STG
    # -------------------------------------------------------
    report_html = None

    if selected_hour:
        try:
            sh_int = int(selected_hour)

            # First try PRD
            row = (
                session.query(SodPrd)
                .filter(
                    SodPrd.uploaddate == selected_date_obj,
                    SodPrd.uploadhour == sh_int
                )
                .first()
            )

            # If not in PRD, check STG
            if not row:
                row = (
                    session.query(SodStg)
                    .filter(
                        SodStg.uploaddate == selected_date_obj,
                        SodStg.uploadhour == sh_int
                    )
                    .first()
                )

            if row:
                report_html = row.report

        except Exception as e:
            print("Error fetching report:", e)

    return render_template(
        "sod.html",
        environment=request.form.get("environment", "prod"),
        selected_date=raw_date,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html,
    )




@app.route("/get-hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}

    raw_date = data.get("date")
    selected_date_obj = convert_date_format(raw_date)

    if not selected_date_obj:
        return jsonify([])

    session = get_db()

    try:
        # Fetch from PRD
        prd_rows = (
            session.query(SodPrd.uploadhour)
            .filter(SodPrd.uploaddate == selected_date_obj)
            .all()
        )

        # Fetch from STG
        stg_rows = (
            session.query(SodStg.uploadhour)
            .filter(SodStg.uploaddate == selected_date_obj)
            .all()
        )

        # Merge both and keep unique
        merged = set([r[0] for r in prd_rows] + [r[0] for r in stg_rows])

        # Convert to sorted + zfill string format
        hours = [str(h).zfill(2) for h in sorted(merged)]

        return jsonify(hours)

    except Exception as e:
        print("Error in get-hours:", e)
        return jsonify([])






@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():
    session = get_db_session()

    # Default date today
    today = datetime.date.today().strftime("%Y-%m-%d")
    raw_date = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")
    
    # Convert incoming date string
    selected_date_obj = convert_date_format(raw_date)

    # Choose which table to use (example: based on a form field 'environment')
    environment = request.form.get("environment", "prd")  # prd or stg
    if environment == "prd":
        model = SodPrd
    else:
        model = SodStg

    available_times = []
    report_html = None

    if selected_date_obj:
        # Fetch available hours for selected date
        rows = (
            session.query(model.uploadhour)
            .filter(model.uploaddate == selected_date_obj)
            .order_by(model.uploadhour)
            .all()
        )
        available_times = [str(r[0]).zfill(2) for r in rows]

    # Fetch report if hour is selected
    if selected_hour:
        try:
            sh_int = int(selected_hour)
            row = (
                session.query(model)
                .filter(model.uploaddate == selected_date_obj, model.uploadhour == sh_int)
                .first()
            )
            if row:
                report_html = row.report
        except Exception as e:
            print("Error fetching report:", e)

    return render_template(
        "SOD.html",
        environment=environment,
        selected_date=raw_date,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )



from flask import Flask, request, jsonify
import datetime

app = Flask(__name__)

# Assuming your models and SessionLocal / get_db_session() are already defined:
# SodPrd, SodStg

def convert_date_format(date_str):
    """Convert date string 'YYYY-MM-DD' to datetime.date"""
    try:
        return datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
    except Exception:
        return None

@app.route("/get_hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}
    raw_date = data.get("date")
    table_name = data.get("table")  # "prd" or "stg"

    selected_date_obj = convert_date_format(raw_date)
    if not selected_date_obj:
        return jsonify([])

    session = get_db_session()  # your existing session function

    try:
        # Select table based on input
        if table_name == "prd":
            model = SodPrd
        elif table_name == "stg":
            model = SodStg
        else:
            return jsonify([])  # unknown table

        rows = (
            session.query(model.uploadhour)
            .filter(model.uploaddate == selected_date_obj)
            .order_by(model.uploadhour)
            .all()
        )

        hours = [str(r[0]).zfill(2) for r in rows]
        return jsonify(hours)
    finally:
        session.close()


if __name__ == "__main__":
    app.run(debug=True)

<!DOCTYPE html>
<html>
<head>
    <title>SOD Checks</title>

    <!-- NEW: jQuery added for AJAX -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

<div style="background:#f2f212; padding:20px; margin-top:40px; margin-left:20px;">

    <h2 style="color:#1EBCAA; margin-bottom:20px;">Start of Day Checks</h2>

    <!-- FORM START -->
    <form action="/sod-checks" method="POST" style="background:#F4F474; padding:20px; border-radius:3px;">

        <!-- ENVIRONMENT DROPDOWN (PRD/STG) -->
        <label><b>Environment:</b></label>
        <select id="env" name="environment" class="form-control mb-3">
            <option value="prd" {% if environment == 'prd' %}selected{% endif %}>PRD</option>
            <option value="stg" {% if environment == 'stg' %}selected{% endif %}>STG</option>
        </select>

        <!-- DATE PICKER -->
        <label><b>Select Date:</b></label>
        <input type="date" id="dateField" name="selected_date" class="form-control mb-3"
               value="{{ selected_date }}" required>

        <!-- HOUR DROPDOWN (auto-filled by AJAX) -->
        <label><b>Select Hour:</b></label>
        <select id="hourField" name="selected_hour" class="form-control mb-3">
            {% if available_times %}
                {% for hr in available_times %}
                    <option value="{{ hr }}" {% if selected_hour == hr %}selected{% endif %}>{{ hr }}</option>
                {% endfor %}
            {% else %}
                <option>No time available</option>
            {% endif %}
        </select>

        <button type="submit" style="width:100%; background:#1E8CCA; color:white; padding:10px; border:none;">
            Load Data
        </button>
    </form>

    <!-- REPORT RENDERING -->
    {% if report_html %}
        {% include report_html %}
    {% endif %}

</div>


<!-- NEW: AJAX CODE to auto-refresh hours -->
<script>
    $("#dateField, #env").on("change", function () {

        let selectedDate = $("#dateField").val();
        let env = $("#env").val();

        $.ajax({
            url: "/get_hours",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                date: selectedDate,
                environment: env
            }),

            success: function (hours) {

                let dropdown = $("#hourField");
                dropdown.empty();   // NEW: clear previous values

                if (hours.length === 0) {
                    dropdown.append('<option>No time available</option>');
                } else {
                    hours.forEach(function (h) {
                        dropdown.append(`<option value="${h}">${h}</option>`);
                    });
                }
            }
        });
    });
</script>

</body>
</html>





from flask import Flask, render_template, request, jsonify
import datetime

# Import your controller functions
from controller import (
    get_hours_from_prd,
    get_hours_from_stg,
    get_report_from_prd,
    get_report_from_stg
)

app = Flask(__name__)


# ---------------------------
# Convert yyyy-mm-dd ‚Üí date
# ---------------------------
def convert_date(date_str):
    try:
        return datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
    except:
        return None


# ---------------------------
# MAIN SOD PAGE
# ---------------------------
@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():
    environment = request.form.get("environment", "prd")

    # Get today's date if no selection
    today = datetime.date.today().strftime("%Y-%m-%d")

    selected_date_raw = request.form.get("selected_date", today)
    date_obj = convert_date(selected_date_raw)

    selected_hour = request.form.get("selected_hour", "")

    # Fetch hours from DB depending on environment
    if environment.lower() == "prd":
        available_times = get_hours_from_prd(date_obj)
    else:
        available_times = get_hours_from_stg(date_obj)

    report_html = None

    # If hour is selected ‚Üí fetch report
    if selected_hour:
        hour_int = int(selected_hour)
        try:
            if environment.lower() == "prd":
                report_html = get_report_from_prd(date_obj, hour_int)
            else:
                report_html = get_report_from_stg(date_obj, hour_int)
        except Exception as e:
            print("Error fetching report:", e)
            report_html = None

    return render_template(
        "sod.html",
        environment=environment,
        selected_date=selected_date_raw,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )


# ---------------------------
# AJAX API ‚Üí get hours
# ---------------------------
@app.route("/get_hours", methods=["POST"])
def get_hours():
    req = request.json
    environment = req.get("environment")
    raw_date = req.get("date")

    date_obj = convert_date(raw_date)

    # PRD or STG
    if environment.lower() == "prd":
        hours = get_hours_from_prd(date_obj)
    else:
        hours = get_hours_from_stg(date_obj)

    return jsonify(hours)


# ---------------------------
# Start Flask App
# ---------------------------
if __name__ == "__main__":
    app.run(debug=True)




app.py# app.py
from flask import Flask, render_template, request, jsonify
import datetime
from controller import get_db_session, sod

app = Flask(__name__)

# -------------------------
# Helpers
# -------------------------
def convert_date_format(date_str):
    """
    If user sends yyyy-mm-dd, return same.
    If user sends mm-dd-yyyy, convert to yyyy-mm-dd.
    Also tolerate small mistakes.
    """
    if not date_str:
        return None

    # Try parse yyyy-mm-dd
    try:
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
        return dt
    except Exception:
        pass

    # Try parse mm-dd-yyyy (common in your mock data)
    try:
        dt = datetime.datetime.strptime(date_str, "%m-%d-%Y").date()
        return dt
    except Exception:
        # fallback: return original string as-is (caller must handle)
        return None


# -------------------------
# ROUTES
# -------------------------
@app.route("/")
def index():
    # render a page that will include the SOD form (or redirect to proper UI)
    return render_template("base.html")


@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():
    session = get_db_session()
    today = datetime.date.today().strftime("%Y-%m-%d")
    selected_date_raw = request.form.get("selected_date", today)
    selected_hour = request.form.get("selected_time", "")

    # convert incoming date string (supports yyyy-mm-dd and mm-dd-yyyy)
    selected_date_obj = convert_date_format(selected_date_raw)
    available_times = []

    if selected_date_obj:
        # Query DB for uploadhour values for that date
        rows = (
            session.query(sod.uploadhour)
            .filter(sod.uploaddate == selected_date_obj)
            .order_by(sod.uploadhour)
            .all()
        )
        available_times = [str(r[0]).zfill(2) for r in rows]  # keep string like "01", "02" to match UI

    report_html = None
    if selected_hour:
        # fetch report for that date+hour
        try:
            sh_int = int(selected_hour)
            row = (
                session.query(sod)
                .filter(sod.uploaddate == selected_date_obj, sod.uploadhour == sh_int)
                .first()
            )
            if row:
                report_html = row.report
        except Exception as e:
            print("Error fetching report:", e)

    return render_template(
        "SOD.html",
        environment=request.form.get("environment", "prd"),
        selected_date=selected_date_raw,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html,
    )


# New route to get hours dynamically via AJAX (expects JSON with {"date": "yyyy-mm-dd"})
@app.route("/get_hours", methods=["POST"])
def get_hours():
    data = request.get_json() or {}
    selected_date_raw = data.get("date")
    selected_date_obj = convert_date_format(selected_date_raw)

    if not selected_date_obj:
        return jsonify([])

    session = get_db_session()
    rows = (
        session.query(sod.uploadhour)
        .filter(sod.uploaddate == selected_date_obj)
        .order_by(sod.uploadhour)
        .all()
    )
    hours = [str(r[0]).zfill(2) for r in rows]
    return jsonify(hours)


if __name__ == "__main__":
    app.run(debug=True)

controller. py# controller.py
import datetime
from sqlalchemy import create_engine, Column, Integer, Date, Text
from sqlalchemy.orm import sessionmaker, declarative_base
from sqlalchemy.exc import SQLAlchemyError
from sqlalchemy.schema import CreateSchema
import psycopg2

# -------------------------
# CONFIG - change these
# -------------------------
DB_USER = "username"
DB_PASS = "password"
DB_HOST = "localhost"
DB_PORT = "5432"
DB_NAME = "yourdb"
schema_name = "public"   # change if needed

DATABASE_URL = f"postgresql://{DB_USER}:{DB_PASS}@{DB_HOST}:{DB_PORT}/{DB_NAME}"

# -------------------------
# ENGINE & SCHEMA
# -------------------------
engine = create_engine(DATABASE_URL, pool_pre_ping=True)
# create schema if not exists (Postgres)
try:
    with engine.connect() as connection:
        connection.execute(CreateSchema(schema_name, if_not_exists=True))
        # no explicit commit needed for DDL in most setups; this is fine
except Exception as e:
    # if schema already exists or DB user has no rights, ignore or log
    print("Create schema warning:", e)

SessionLocal = sessionmaker(autoflush=True, bind=engine)
Base = declarative_base()


# -------------------------
# Optional raw psycopg2 connection helper
# -------------------------
def getConnection(host, port, database, username, password):
    try:
        conn = psycopg2.connect(user=username, password=password, host=host, port=port, database=database)
        return conn
    except Exception as e:
        print(f"Not able to connect with error: {e}")
        return None


# -------------------------
# MODEL
# -------------------------
class sod(Base):
    __tablename__ = "sod_prd"
    __table_args__ = {"schema": schema_name}

    # composite primary key using primary_key=True on both columns
    uploaddate = Column(Date, primary_key=True, default=datetime.date.today)
    uploadhour = Column(Integer, primary_key=True, nullable=False)
    report = Column(Text, nullable=False)

    def __repr__(self):
        return f"{self.uploaddate}, {self.uploadhour}, {self.report}"


# create tables if not exists
def init_db():
    try:
        Base.metadata.create_all(bind=engine)
        print("DB tables created/checked successfully")
    except SQLAlchemyError as e:
        print("Error creating tables:", e)


# provide a session factory
def get_db_session():
    return SessionLocal()


# init on import (optional)
init_db()


sod.html
<!-- templates/SOD.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Start of Day Checks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- jQuery CDN (ensure server can access internet) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Bootstrap CSS (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div style="background:#f2f2f2; padding: 20px; margin-top:20px; margin-left:20px;">
    <h2 style="color:#1EBCAA; margin-bottom:20px;">Start of Day Checks</h2>

    <form action="/sod-checks" method="POST" style="background: #F4F474; padding:20px; border-radius: 3px; box-shadow:0 0 5px rgba(0,0,0,0.2)">
      <!-- Environment -->
      <label class="fw-bold">Environment:</label>
      <select id="environment" name="environment" class="form-control mb-3" required>
        <option value="prd" {% if environment == "prd" %}selected{% endif %}>PRD</option>
        <option value="stg" {% if environment == "stg" %}selected{% endif %}>STG</option>
      </select>

      <!-- Select Date -->
      <label class="fw-bold">Select Date:</label>
      <input type="date" id="selected_date" name="selected_date" class="form-control mb-3" required value="{{ selected_date if selected_date else '' }}">

      <!-- Select Hour -->
      <label class="fw-bold">Select Hour:</label>
      <select id="selected_time" name="selected_time" class="form-control mb-3" required>
        {% if available_times %}
          {% for t in available_times %}
            <option value="{{ t }}" {% if selected_hour == t %}selected{% endif %}>{{ t }}:00</option>
          {% endfor %}
        {% else %}
          <option value="">No time available</option>
        {% endif %}
      </select>

      <button type="submit" style="width:100%; background:#1EBCAA; color:white; padding:10px; border:none; font-size:16px">Load Data</button>
    </form>

    <br>

    <!-- Report area (if any) -->
    <div id="report_area" style="margin-top:20px;">
      {% if report_html %}
        <h4>Report</h4>
        <div style="white-space:pre-wrap; background:#fff; padding:10px; border-radius:4px; border:1px solid #ddd;">
          {{ report_html|safe }}
        </div>
      {% endif %}
    </div>
  </div>

<script>
$(document).ready(function(){
  // When date changes, call /get_hours
  $("#selected_date").on("change", function(){
    let dateVal = $(this).val(); // yyyy-mm-dd
    if(!dateVal) return;

    $.ajax({
      url: "/get_hours",
      method: "POST",
      contentType: "application/json",
      data: JSON.stringify({ date: dateVal }),
      success: function(hours) {
        let dropdown = $("#selected_time");
        dropdown.empty();

        if (!hours || hours.length === 0) {
          dropdown.append('<option value="">No time available</option>');
          return;
        }

        hours.forEach(function(h){
          dropdown.append(`<option value="${h}">${h}:00</option>`);
        });
      },
      error: function(err) {
        console.error("Error fetching hours", err);
      }
    });
  });
});
</script>
</body>
</html>




<!-- Menu Button -->
<button id="menuBtn" class="menu-btn">‚ò∞</button>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <button id="closeArrow" class="close-arrow">‚Üê</button>
        <h3>Menu</h3>
    </div>

    <a href="#">Home</a>
    <a href="#">Leave</a>
    <a href="#">Remote Working</a>
    <a href="#">Allowance</a>
    <a href="#">Exit Process</a>
</div>

<!-- Overlay -->
<div id="overlay"></div>






/* Sidebar */
.sidebar {
    position: fixed;
    left: -260px;       /* hidden */
    top: 0;
    width: 260px;
    height: 100%;
    background: #ffffff;
    box-shadow: 2px 0 10px rgba(0,0,0,0.15);
    transition: left 0.3s ease;
    z-index: 2000;
    padding-top: 10px;
}

/* When active: slide in */
.sidebar.active {
    left: 0;
}

/* Sidebar links */
.sidebar a {
    display: block;
    padding: 12px 20px;
    font-size: 16px;
    color: #222;
    text-decoration: none;
}
.sidebar a:hover {
    background: #efefef;
}

/* Menu button */
.menu-btn {
    position: fixed;
    left: 10px;
    top: 10px;
    background: #2E7D32;
    color: white;
    border: none;
    padding: 8px 12px;
    font-size: 20px;
    cursor: pointer;
    z-index: 3000;
    border-radius: 4px;
}

/* Arrow button */
.close-arrow {
    background: none;
    border: none;
    font-size: 22px;
    cursor: pointer;
    margin-right: 10px;
}

/* Sidebar header row */
.sidebar-header {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    border-bottom: 1px solid #ddd;
}

/* Overlay */
#overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    display: none;
    z-index: 1500;
}
#overlay.show {
    display: block;
}








<script>
const sidebar = document.getElementById("sidebar");
const menuBtn = document.getElementById("menuBtn");
const closeArrow = document.getElementById("closeArrow");
const overlay = document.getElementById("overlay");

function openSidebar() {
    sidebar.classList.add("active");
    overlay.classList.add("show");
}

function closeSidebar() {
    sidebar.classList.remove("active");
    overlay.classList.remove("show");
}

menuBtn.onclick = openSidebar;
closeArrow.onclick = closeSidebar;
overlay.onclick = closeSidebar;
</script>






from flask import Flask, render_template, request, jsonify
import datetime

app = Flask(__name__)

# Mock DB of available times
MOCK_DB = {
    "11-20-2025": ["01:00", "02:00", "05:00"],
    "11-21-2025": ["03:00", "04:00"],
    "11-22-2025": ["02:00", "06:00", "07:00"],
}

def get_available_times(date):
    return MOCK_DB.get(date, [])

# Convert yyyy-mm-dd to mm-dd-yyyy
def convert_date_format(date_str):
    try:
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d")
        return dt.strftime("%m-%d-%Y")
    except:
        return date_str

@app.route("/")
def home():
    return render_template("base.html")

@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():
    environment = request.form.get("environment", "prd")
    today = datetime.date.today().strftime("%Y-%m-%d")
    selected_date_raw = request.form.get("selected_date", today)
    selected_date = convert_date_format(selected_date_raw)
    selected_hour = request.form.get("selected_time", "")
    available_times = get_available_times(selected_date)
    report_html = "sample.html" if selected_hour else None

    return render_template(
        "SOD.html",
        environment=environment,
        selected_date=selected_date_raw,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )

# New route to get hours dynamically via AJAX
@app.route("/get_hours", methods=["POST"])
def get_hours():
    selected_date_raw = request.json.get("date")
    selected_date = convert_date_format(selected_date_raw)
    hours = get_available_times(selected_date)
    return jsonify(hours)

if __name__ == "__main__":
    app.run(debug=True)









<div style="background:#f2f2f2; padding: 20px; margin-top:40px; margin-left:20px;">

    <h2 style="color:#1E8C3A; margin-bottom:20px;">Start of Day Checks</h2>

    <form action="/sod-checks" method="POST"
          style="background: #F4F4F4; padding:20px; border-radius: 8px; box-shadow:0 0 5px rgba(0,0,0,0.2);">

        <!-- Environment Dropdown -->
        <label class="fw-bold">Environment:</label>
        <select id="envSelect" name="environment" class="form-control mb-3" required>
            <option value="prd" {% if environment=='prd' %}selected{% endif %}>PRD</option>
            <option value="stg" {% if environment=='stg' %}selected{% endif %}>STG</option>
        </select>

        <!-- Select Date -->
        <label class="fw-bold">Select Date:</label>
        <input type="date" id="dateField" name="selected_date" class="form-control mb-3" required
               value="{{ selected_date }}">

        <!-- Select Hour -->
        <label class="fw-bold">Select Hour:</label>
        <select id="hourField" name="selected_time" class="form-control mb-3" required>
            {% if available_times %}
                {% for t in available_times %}
                    <option value="{{ t }}" {% if t == selected_hour %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            {% else %}
                <option>No time available</option>
            {% endif %}
        </select>

        <button type="submit"
                style="width: 100%; background: #1E8C3A; color: white; padding:10px; border:none; font-size:16px;">
            Load Data
        </button>
    </form>

    <br><br>

    {% if report_html %}
        <iframe src="{{ report_html }}"
                style="width: 100%; height:700px; border:1px solid #aaa; border-radius:8px;"></iframe>
    {% else %}
        <p style="color: red;">No report found for this date/time.</p>
    {% endif %}

</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- AJAX to update hours dynamically -->
<script>
$(document).ready(function() {
    $('#dateField').on('change', function() {
        const date = $(this).val();
        if (date) {
            $.ajax({
                url: '/get_hours',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ date: date }),
                success: function(hours) {
                    const $hourField = $('#hourField');
                    $hourField.empty().append('<option value="">--Select Hour--</option>');
                    if (hours.length > 0) {
                        hours.forEach(function(h) {
                            $hourField.append(`<option value="${h}">${h}</option>`);
                        });
                    } else {
                        $hourField.append('<option>No time available</option>');
                    }
                }
            });
        }
    });
});
</script>











from flask import Flask, render_template, request
import datetime

app = Flask(__name__)

# ---- MOCK DATABASE (Date ‚Üí Times) ----
MOCK_DB = {
    "11-20-2025": ["01:00", "02:00", "05:00"],
    "11-21-2025": ["03:00", "04:00"],
    "11-22-2025": ["02:00", "06:00", "07:00"],
}


# Fetch times from MOCK_DB
def get_available_times(date):
    return MOCK_DB.get(date, [])


# Convert yyyy-mm-dd ‚Üí mm-dd-yyyy to match MOCK_DB
def convert_date_format(date_str):
    try:
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d")
        return dt.strftime("%m-%d-%Y")
    except:
        return date_str


@app.route("/")
def home():
    # Redirect directly to SOD page
    return render_template("SOD.html",
                           environment="prd",
                           selected_date="",
                           selected_hour="",
                           available_times=[],
                           report_html=None)


@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():

    # Environment
    environment = request.form.get("environment", "prd")

    # Today's date
    today = datetime.date.today().strftime("%Y-%m-%d")

    # User-selected date (yyyy-mm-dd)
    selected_date_raw = request.form.get("selected_date", today)

    # Convert yyyy-mm-dd ‚Üí mm-dd-yyyy
    selected_date = convert_date_format(selected_date_raw)

    # Selected hour
    selected_hour = request.form.get("selected_time", "")

    # Fetch all times for that date
    available_times = get_available_times(selected_date)

    # Show report only when hour selected
    report_html = "sample.html" if selected_hour else None

    return render_template(
        "SOD.html",
        environment=environment,
        selected_date=selected_date_raw,
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )


if __name__ == "__main__":
    app.run(debug=True)


<!DOCTYPE html>
<html>
<head>
    <title>SOD Checks</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body style="background:#f2f2f2;">

<div style="padding:20px; margin-top:40px; margin-left:20px;">

    <h2 style="color:#1E8C3A; margin-bottom:20px;">Start of Day Checks</h2>

    <form action="/sod-checks" method="POST"
          style="background:#F4F4F4; padding:20px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1);">

        <!-- Environment Dropdown -->
        <label class="fw-bold">Environment:</label>
        <select id="envSelect" name="environment" class="form-control mb-3" required>
            <option value="prd" {% if environment == 'prd' %}selected{% endif %}>PRD</option>
            <option value="stg" {% if environment == 'stg' %}selected{% endif %}>STG</option>
        </select>

        <!-- Select Date -->
        <label class="fw-bold">Select Date:</label>
        <input type="date" id="dateField" name="selected_date" class="form-control mb-3"
               required value="{{ selected_date }}">

        <!-- Select Hour -->
        <label class="fw-bold">Select Hour:</label>
        <select name="selected_time" class="form-control mb-3" required>
            {% if available_times %}
                {% for t in available_times %}
                    <option value="{{ t }}" {% if t == selected_hour %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            {% else %}
                <option>No time Available</option>
            {% endif %}
        </select>

        <button type="submit"
                style="width:100%; background:#1E8C3A; color:white; padding:10px; border:none; font-size:16px;">
            Load Data
        </button>
    </form>

    <br><br>

    {% if report_html %}
        <iframe src="{{ report_html }}" style="width:100%; height:700px; border:1px solid #aaa; border-radius:8px;"></iframe>
    {% else %}
        <p style="color:red;">No report found for this date/time.</p>
    {% endif %}

</div>

<script>
    // Set default date only if user has not submitted the form yet
    window.onload = function () {
        let currentDate = new Date().toISOString().split("T")[0];

        {% if not selected_date %}
        document.getElementById("dateField").value = currentDate;
        {% endif %}
    }
</script>

</body>
</html>
55555555
<body>

<div style="padding: 20px; margin-top: 40px; margin-left: 20px;">

<form method="POST" action="/sod">

    <label style="font-weight:bold;">Select Date:</label>
    <input type="date"
           id="dateField"
           name="selected_date"
           value=""
           required
           style="width:100%; padding: 8px; border-radius: 6px; border:1px solid #ccc;">


    <label style="font-weight:bold;">Select Hour:</label>
    <select id="timeDropdown"
            name="selected_time"
            required
            style="width:100%; padding: 8px; margin:10px 0; border-radius: 6px; border:1px solid #ccc;">
        <option disabled selected>Select date first</option>
    </select>

</form>


<script>
// ---------- SET TODAY BY DEFAULT ----------
document.getElementById("dateField").value = new Date().toISOString().split("T")[0];


// ---------- WHEN DATE CHANGES ‚Üí FETCH TIME SLOTS ----------
document.getElementById("dateField").addEventListener("change", function () {

    let selectedDate = this.value;

    fetch("/get_time_slots", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selected_date: selectedDate })
    })
    .then(res => res.json())
    .then(data => {

        let dropdown = document.getElementById("timeDropdown");
        dropdown.innerHTML = "";  // Clear old options

        if (data.time_slots.length > 0) {
            data.time_slots.forEach(t => {
                let opt = document.createElement("option");
                opt.value = t;
                opt.textContent = t;
                dropdown.appendChild(opt);
            });
        } else {
            let opt = document.createElement("option");
            opt.textContent = "No time available";
            dropdown.appendChild(opt);
        }
    });
});
</script>

</body>
final
@app.route("/get_time_slots", methods=["POST"])
def get_time_slots():
    data = request.get_json()
    selected_date = data.get("selected_date")
    time_slots = mock_db.get(selected_date, [])
    return jsonify({"time_slots": time_slots})
<script>
_______
document.getElementById("dateField").addEventListener("change", function () {

    let selectedDate = this.value;

    // Make POST call to Flask route
    fetch("/get_time_slots", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selected_date: selectedDate })
    })
    .then(response => response.json())
    .then(data => {

        let timeDropdown = document.querySelector("select[name='selected_time']");
        timeDropdown.innerHTML = ""; // clear old values

        if (data.time_slots.length > 0) {
            data.time_slots.forEach(time => {
                let opt = document.createElement("option");
                opt.value = time;
                opt.textContent = time;
                timeDropdown.appendChild(opt);
            });
        } else {
            let opt = document.createElement("option");
            opt.textContent = "No time available";
            timeDropdown.appendChild(opt);
        }
    });
});
</script>
ddddd
from flask import Flask, render_template, request
import datetime

app = Flask(__name__)

# MOCK DB : Date format MUST be mm-dd-yyyy
MOCK_DB = {
    "11-20-2025": ["01:00", "02:00", "05:00"],
    "11-21-2025": ["03:00", "04:00"],
    "11-22-2025": ["02:00", "06:00", "07:00"]
}

def get_available_times(date):
    return MOCK_DB.get(date, [])

def convert_date_format(date_str):
    """Convert yyyy-mm-dd ‚Üí mm-dd-yyyy to match MOCK_DB"""
    try:
        dt = datetime.datetime.strptime(date_str, "%Y-%m-%d")
        return dt.strftime("%m-%d-%Y")
    except:
        return date_str

@app.route("/")
def home():
    return render_template("base.html")

@app.route("/sod-checks", methods=["GET", "POST"])
def sod_page():
    environment = request.form.get("environment", "prd")

    # Today's date in yyyy-mm-dd for HTML input
    today = datetime.date.today().strftime("%Y-%m-%d")
    selected_date_raw = request.form.get("selected_date", today)

    # Convert to match MOCK_DB
    selected_date = convert_date_format(selected_date_raw)

    selected_hour = request.form.get("selected_time", "")

    available_times = get_available_times(selected_date)

    # Static HTML Report
    report_html = "sample.html" if selected_hour else None

    return render_template(
        "SOD.html",
        environment=environment,
        selected_date=selected_date_raw,  # keep original format for UI
        selected_hour=selected_hour,
        available_times=available_times,
        report_html=report_html
    )

if __name__ == "__main__":
    app.run(debug=True)


---------------

from flask import Flask, render_template, request, jsonify
import datetime

app = Flask(__name__)

# ---- Mock database ----
mock_db = {
    "2025-01-10": ["10:00 AM", "11:00 AM", "02:00 PM"],
    "2025-01-11": ["09:00 AM", "01:00 PM"],
    "2025-01-12": ["12:00 PM", "03:30 PM"]
}


@app.route("/")
def index():
    return render_template("index.html")


# -----------------------------
# ‚úÖ SOD PAGE ROUTE (You asked for this)
# -----------------------------
@app.route("/sod-checks", methods=["GET", "POST"])
def sod_checks():
    # Default environment and date
    environment = request.form.get("environment", "prd")
    today = datetime.date.today().strftime("%Y-%m-%d")
    selected_date = request.form.get("selected_date", today)
    selected_time = request.form.get("selected_time", "")

    # Fetch available times based on selected date
    available_times = mock_db.get(selected_date, [])

    # Only generate report if time is selected
    report_html = "sample.html" if selected_time else None

    return render_template(
        "sod.html",
        environment=environment,
        selected_date=selected_date,
        selected_time=selected_time,
        available_times=available_times,
        report_html=report_html
    )


# -----------------------------
# ‚úÖ AJAX endpoint for auto-populating time dropdown
# -----------------------------
@app.route("/get_time_slots", methods=["POST"])
def get_time_slots():
    data = request.get_json()
    selected_date = data.get("selected_date")

    # Match date exactly with mock_db keys
    time_slots = mock_db.get(selected_date, [])

    return jsonify({"time_slots": time_slots})


if __name__ == "__main__":
    app.run(debug=True)
hhhhhhhh
DGood morning everyone,
I‚Äôm [Your Name], currently working as a Full Stack Developer Intern with GBIT ISPL ‚Äì Trade DPP, Mumbai. Over the last six months, I‚Äôve been part of a very exciting project called Conserto, which has been a huge learning experience ‚Äî both technically and personally.

So, what exactly is Conserto?
Conserto is an internal application developed for Trade Finance operations at BNP Paribas. In simple words, it helps organize and manage all customer trade requests between two countries or regions.

The Conserto application works across both Middle Office and Back Office operations ‚Äî meaning it supports everything from the moment a trade request is received, till it is completely processed and recorded.

It is both an EDM ‚Äî Electronic Document Management tool, and a Workflow Management system.

Think of it like a smart engine that automates and tracks the journey of a trade event ‚Äî such as a Letter of Credit or Collection ‚Äî right from creation to completion. Every document, every approval, and every correction is managed inside Conserto.


---

Key Functionalities of Conserto:

1Ô∏è‚É£ Queue Management ‚Äî
Conserto automatically organizes pending requests, identifies priorities, and shows them in a ‚ÄúTo-do list.‚Äù It helps users focus on what‚Äôs important first.

2Ô∏è‚É£ Workflow Handling ‚Äî
Each trade event passes through multiple validation levels ‚Äî like 2-eye, 4-eye, or 6-eye checks ‚Äî depending on business rules. This ensures accuracy, compliance, and traceability.

3Ô∏è‚É£ Roles and Permissions ‚Äî
Every user has a specific role:

Producers from the Middle Office initiate and validate transactions.

Processors in the Back Office handle the data entry and final processing.

The Center of Excellence team manages complex transactions.

And Investigators verify document attachments and handle claims.


4Ô∏è‚É£ Transverse Features ‚Äî
Conserto even allows communication between users, setting reminders, alerts, and managing throwbacks or reviews. It maintains a complete audit trail for every transaction, ensuring full transparency.


---

Now, coming to my contribution and learning:

In the initial weeks, we had detailed KT sessions to understand how the application actually fits into BNP Paribas‚Äôs Trade ecosystem ‚Äî how customer requests flow from Connexis Trade or SWIFT into Conserto, and then to iVision, where they‚Äôre processed and completed.

After the knowledge sessions, I was assigned a few JIRA tasks related to the Conserto tech stack, which includes Java, Spring Boot, Angular, and database handling.

Coming from a Python background, this was a completely new world for me. I still remember my first few days ‚Äî debugging something simple felt like solving a mystery. üòÖ

But slowly, with constant guidance from my mentors and teammates, I began to understand the structure ‚Äî how every API, workflow, and front-end component plays its part.

I started working on small enhancements and bug fixes in modules like queue visualization and workflow tracking, and also explored how exceptions are handled during document validation.

What made this experience even better was how well the team supported me. The environment they created was incredibly warm ‚Äî I could reach out anytime with questions, whether technical or functional. Daily stand-ups and review calls helped me stay on track and understand how my work contributed to the bigger picture.


---

What I truly learned from this project is that real-world development is not just about writing code ‚Äî it‚Äôs about understanding the business need behind every line of that code.

In college, we just built projects to submit. But here, I learned how each feature goes through multiple layers ‚Äî development, validation, review, and deployment ‚Äî all with real-time coordination between teams.

Conserto also taught me about collaboration ‚Äî how different roles, from Middle Office to Back Office, work together in a single workflow system to deliver accurate results for clients across the globe.


---

If I describe my journey in one line, I‚Äôd say it‚Äôs been like climbing a mountain ‚Äî tough at the start, but every step brings a new view.
Each task, each review, and even each bug helped me learn something new.

The constant support from my managers and mentors played a huge role ‚Äî they never let me feel left out. They balanced fun and learning perfectly, with engaging training sessions and open communication.


---

And if I look back, from the hackathon experience to understanding Conserto‚Äôs workflows, from struggling with backend logic to finally seeing things work on production ‚Äî it‚Äôs been a complete transformation.

This internship didn‚Äôt just make me a better developer ‚Äî it taught me ownership, teamwork, and the joy of learning something new every single day.


---

To conclude, I‚Äôd like to say that Conserto wasn‚Äôt just a project for me ‚Äî it was a journey of discovery, patience, and growth. I‚Äôm truly grateful to my team, mentors, and the organization for creating an environment where learning never stops.

Thank you! üôè

-----------------------------------66666-

during my six-month internship as a Full Stack Developer at GBIT ISPL ‚Äì Trade DPP, Mumbai, I worked on the Conserto application. Conserto is an EDM and Workflow Management tool that helps organize trade finance requests between two countries or regions. It manages every step of the trade lifecycle ‚Äî from customer requests in Connexis Trade and SWIFT to back-office processing in iVision.

We started with KT sessions to understand the project, and then I was assigned small JIRA tasks. Coming from a Python background, it wasn‚Äôt easy, but with my team‚Äôs guidance, I learned Java, Spring Boot, and Angular. Every task taught me something new. The environment was warm and encouraging ‚Äî I never felt left out. This internship truly helped me grow ‚Äî not just as a developer, but as a learner every single day.




@Override
public File generateXml(ExternalTNTRequest externalTandTRequest, String xmlFilePath) {
    log.info("Generating XML for prodCode: {} and eventId: {}", 
             externalTandTRequest.getProdCode(), externalTandTRequest.getEventId());

    IcTnxRecord icTnxRecord = new IcTnxRecord();

    // Set all common mandatory fields
    setCommonFields(icTnxRecord, externalTandTRequest);

    // Set application date always if no refId
    if (StringUtils.isBlank(externalTandTRequest.getConnexisRequestRefId())) {
        icTnxRecord.setAppl_date(
            DateTimeUtil.getDateInDDMMYYYY(externalTandTRequest.getEventCreationDateTime())
        );

        // üëâ Only set currency + amounts if ConnexisRequestRefId is missing
        if (StringUtils.isNotBlank(externalTandTRequest.getCurCode())) {
            icTnxRecord.setTnx_cur_code(externalTandTRequest.getCurCode());
            icTnxRecord.setIc_cur_code(externalTandTRequest.getCurCode());
        }

        if (externalTandTRequest.getTnxAmt() != null) {
            String formattedAmt = formatAmount(externalTandTRequest.getTnxAmt());
            icTnxRecord.setTnx_amt(formattedAmt);
            icTnxRecord.setIc_amt(formattedAmt);
            icTnxRecord.setIc_liab_amt(formattedAmt);
        }
    }

    // Drawer / Customer details
    if (StringUtils.isNotBlank(externalTandTRequest.getCustomerId()) && 
        StringUtils.isNotBlank(externalTandTRequest.getBranchCode())) {

        String drawerReference = externalTandTRequest.getCustomerId();
        String branchCode = externalTandTRequest.getBranchCode();

        if (drawerReference.length() >= 5 
            && drawerReference.substring(0, 5).equalsIgnoreCase(branchCode)) {
            icTnxRecord.setDrawer_reference(drawerReference);
        }
    }

    icTnxRecord.setDrawee_name(externalTandTRequest.getCounterPartyName());
    icTnxRecord.setCompany_name(externalTandTRequest.getEbCusId());
    icTnxRecord.setDrawer_abbv_name(externalTandTRequest.getEbBanId());

    AdditionalField additionalField = new AdditionalField(
        "mo_event_id", "string", "transaction", externalTandTRequest.getEventId()
    );
    icTnxRecord.setAdditionalFields(List.of(additionalField));

    return generateXmlFile(externalTandTRequest.getEventId(), icTnxRecord, xmlFilePath);
}

// helper
private String formatAmount(String amt) {
    try {
        double value = Double.parseDouble(amt);
        return String.format("%.2f", value); // always 2 decimal places
    } catch (NumberFormatException e) {
        return amt; // fallback
    }
}




----------------------------------


package com.bnpparibas.mql.helper;

import com.bnpparibas.dpw.controller.model.Request;
import com.bmpparibas.dpw.mql.model.ExternalTNTRequest;
import com.bmpparibas.dpw.referential.model.ExternalTrackAndTraceMapping;

import java.time.LocalDateTime;

public class CXTHelper {

    private CXTHelper() {}

    public static ExternalTNTRequest toExternalTNTRequest(
            ExternalTrackAndTraceMapping mapping,
            Request createdRequest
    ) {
        if (mapping == null) return null;

        ExternalTNTRequest req = new ExternalTNTRequest();

        // Mapping fields from ExternalTrackAndTraceMapping
        req.setBranchCode(mapping.getBranchCode());
        req.setCountryCode(mapping.getCountryCode());
        req.setStatusCxt(mapping.getStatusCxt());
        req.setProdCode(mapping.getProdCode());
        req.setTnxTypeCode(mapping.getTnxTypeCode());
        req.setSubTnxTypeCode(mapping.getSubTnxTypeCode());
        req.setProdStatCode(mapping.getProdStatCode());
        req.setTnxStatCode(mapping.getTnxStatCode());

        // Mapping fields from createdRequest
        if (createdRequest != null && createdRequest.getEvent() != null) {
            req.setEventId(createdRequest.getEvent().getId());
            if (createdRequest.getEvent().getSystemCreationDate() != null) {
                req.setEventCreationDateTime(createdRequest.getEvent().getSystemCreationDate());
            } else {
                req.setEventCreationDateTime(LocalDateTime.now());
            }
        } else {
            req.setEventCreationDateTime(LocalDateTime.now());
        }

        // Optional fields you might have in ExternalTNTRequest
        // Leave null if no source available
        req.setTnxAmt(null);
        req.setCurCode(null);
        req.setCounterPartyName(null);
        req.setCustomerId(null);
        req.setConnexisRequestRefId(null);
        req.setConnexisRequestTnxId(null);
        req.setEbCusId(null);
        req.setEbBanId(null);
        req.setBoStatusUpdate(null);
        req.setSubTnxStatCode(null);
        req.setMfr(null);
        req.setLivr(null);
        req.setUmfr(null);

        return req;
    }
}



-------------------_----------------------


public class CXTHelper {

    private CXTHelper() {
        // Utility class
    }

    public static ExternalTNTRequest toExternalTNTRequest(ExternalTrackAndTraceMapping mapping,
                                                          ExternalTNTRequest createdRequest,
                                                          ConnexisData connexisData) {
        if (mapping == null && createdRequest == null && connexisData == null) {
            return new ExternalTNTRequest();
        }

        ExternalTNTRequest request = new ExternalTNTRequest();

        // --- Mapping fields from Referential (mapping) ---
        if (mapping != null) {
            request.setBranchCode(mapping.getBranchCode());
            request.setCountryCode(mapping.getCountryCode());
            request.setPgpeCode(mapping.getPgpeCode());
            request.setAction(mapping.getAction());
            request.setStatusCst(mapping.getStatusCst());
            request.setStatusCxt(mapping.getStatusCxt());
            request.setProdCode(mapping.getProdCode());
            request.setTnxTypeCode(mapping.getTnxTypeCode());
            request.setSubTnxTypeCode(mapping.getSubTnxTypeCode());
            request.setProdStatCode(mapping.getProdStatCode());
            request.setTnxStatCode(mapping.getTnxStatCode());
        }

        // --- Fields from created request (input request) ---
        if (createdRequest != null) {
            request.setEventId(createdRequest.getEventId());
            request.setMfr(createdRequest.getMfr());
            request.setLivr(createdRequest.getLivr());
            request.setUmfr(createdRequest.getUmfr());
            request.setSubTnxStatCode(createdRequest.getSubTnxStatCode());
            request.setBoStatusUpdate(createdRequest.getBoStatusUpdate());
            request.setEventCreationDateTime(createdRequest.getEventCreationDateTime());
            request.setTnxAmt(createdRequest.getTnxAmt());
            request.setCurCode(createdRequest.getCurCode());
            request.setCounterPartyName(createdRequest.getCounterPartyName());
            request.setCustomerId(createdRequest.getCustomerId());
            request.setEbCusId(createdRequest.getEbCusId());
            request.setEbBanId(createdRequest.getEbBanId());
        }

        // --- Fields from ConnexisData (if present) ---
        if (connexisData != null) {
            request.setConnexisRequestRefId(connexisData.getRequestRefId());
            request.setConnexisRequestTnxId(connexisData.getRequestTnxId());
        }

        return request;
    }
}








+++++++++++++++++++++

package com.bnpparibas.mql.helper;

import com.bnpparibas.dpw.controller.model.Request;
import com.bnpparibas.dpw.mql.model.ExternalTNTRequest;
import com.bnpparibas.dpw.referential.model.ExternalTrackAndTraceMapping;

import java.time.LocalDateTime;

public class CXTHelper {

    private CXTHelper() {}

    public static ExternalTNTRequest toExternalTNTRequest(
            ExternalTrackAndTraceMapping mapping,
            Request createdRequest,
            ConnexisData connexisData) {

        if (mapping == null) return null;

        ExternalTNTRequest req = new ExternalTNTRequest();

        // üîπ From Referential Mapping (codes)
        req.setBranchCode(mapping.getBranchCode());
        req.setCountryCode(mapping.getCountryCode());
        req.setProdCode(mapping.getProdCode());
        req.setTnxTypeCode(mapping.getTnxTypeCode());
        req.setSubTnxTypeCode(mapping.getSubTnxTypeCode());
        req.setProdStatCode(mapping.getProdStatCode());
        req.setTnxStatCode(mapping.getTnxStatCode());
        req.setStatusCxt(mapping.getStatusCxt());

        // üîπ From Event (createdRequest)
        if (createdRequest != null && createdRequest.getEvent() != null) {
            req.setEventId(createdRequest.getEvent().getId());
            req.setEventCreationDateTime(
                createdRequest.getEvent().getSystemCreationDate() != null
                        ? createdRequest.getEvent().getSystemCreationDate()
                        : LocalDateTime.now()
            );

            // Example business fields from Event
            req.setCompanyName(createdRequest.getEvent().getCompanyName());
            req.setTnxAmt(createdRequest.getEvent().getTransactionAmount());
            req.setCurCode(createdRequest.getEvent().getCurrency());
            req.setApplicantAbbvName(createdRequest.getEvent().getApplicantName());
            req.setBeneficiaryName(createdRequest.getEvent().getBeneficiaryName());
        }

        // üîπ From ConnexisData (if additional info required)
        if (connexisData != null) {
            req.setCustomerId(connexisData.getCustomerId());
            req.setConnexisRequestRefId(connexisData.getRequestRefId());
            req.setConnexisRequestTnxId(connexisData.getRequestTnxId());
        }

        // üîπ Static / derived fields if required
        req.setBoStatusUpdate("Y"); // defaulted as in expected XML

        return req;
    }
}






------------------------------------------


package com.yourcompany.project.helper;

import com.yourcompany.project.model.ExternalTrackAndTraceMapping;
import com.yourcompany.project.model.ExternalTNTRequest;
import com.yourcompany.project.model.Request;

public final class CXTHelper {

    private CXTHelper() {
        // Utility class
    }

    public static ExternalTNTRequest toExternalTNTRequest(
            ExternalTrackAndTraceMapping mapping,
            Request createdRequest) {

        if (mapping == null) return null;

        ExternalTNTRequest req = new ExternalTNTRequest();

        // ----- fields coming from mapping -----
        req.setBranchCode(mapping.getBranchCode());
        req.setCountryCode(mapping.getCountryCode());
        req.setPgpeCode(mapping.getPgpeCode());
        req.setAction(mapping.getAction());
        req.setStatusCst(mapping.getStatusCst());
        req.setStatusCxt(mapping.getStatusCxt());
        req.setProdCode(mapping.getProdCode());
        req.setTnxTypeCode(mapping.getTnxTypeCode());
        req.setSubTnxTypeCode(mapping.getSubTnxTypeCode());
        req.setProdStatCode(mapping.getProdStatCode());
        req.setTnxStatCode(mapping.getTnxStatCode());

        // ----- info coming from createdRequest -----
        if (createdRequest != null && createdRequest.getEvent() != null) {
            req.setEventId(createdRequest.getEvent().getId());
        }

        return req;
    }
}